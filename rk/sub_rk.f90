module sub_rk
!! Fortran module for main_rk.f90 which solves the dynamic response of 
!! a metabeam of bistable elements using an explicit Runge-Kutta method.
!!
!! Author: Written by Myungwon Hwang (hwang125@purdue.edu)

implicit none
private
public :: calc_f_metabeam, calc_f_pendula, calc_f_phi4, calc_load

contains
    subroutine calc_f_metabeam(BC_flag, lowerBound, upperBound, m, b, p, k, L, x, f)

    !! Data dictionary
    integer, intent(in) :: BC_flag
    integer, intent(in) :: lowerBound
    integer, intent(in) :: upperBound
    real, intent(in), dimension(6) :: m
    real, intent(in), dimension(6) :: b
    real, intent(in), dimension(6) :: p
    real, intent(in), dimension(9) :: k
    real, intent(in), dimension(4) :: L
    real, intent(in), dimension(lowerBound:upperBound) :: x
    real, intent(out), dimension(12) :: f

    f = 0.
    if (BC_flag == 100) then
        f(1) = x(1)

        f(2) = ( p(1) -b(1)*x(1) - ((k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(2)*(L(4) - x(0) + x(4))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(L(4) - x(0) + x(8))*(Sqrt(L(3)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

        f(3) = x(3)
       
        f(4) = ( p(2) -b(2)*x(3) - ((k(1)*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2))*(-x(-10) + x(2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(2)*(L(2) - x(2) + x(6))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) + &
        &  (k(1)*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2))*(x(2) - x(14)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) -b(3)*x(5) - ((k(4)*(L(1) - x(-8) + x(4))*(-L(1) + Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2)))/&
        &   Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2) + &
        &  (k(7)*(L(1) - x(-4) + x(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2) + &
        &  (k(2)*(L(4) - x(0) + x(4))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) - &
        &  (k(4)*(L(1) - x(4) + x(16))*(-L(1) + Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2)))/&
        &   Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2) - &
        &  (k(8)*(L(1) - x(4) + x(20))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)))/&
        &   Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)) )/m(3)

        f(7) = x(7)
        
        f(8) = ( p(4) -b(4)*x(7) - ((k(4)*(-L(1) + Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2))*(-x(-6) + x(6)))/&
        &   Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2) + &
        &  (k(7)*(L(2) + L(3) - x(-2) + x(6))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2) + &
        &  (k(2)*(L(2) - x(2) + x(6))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) + &
        &  (k(4)*(-L(1) + Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2))*(x(6) - x(18)))/&
        &   Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2) + &
        &  (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2))*(L(2) + L(3) + x(6) - x(22)))/&
        &   Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)) )/m(4)

        f(9) = x(9)

        f(10) = ( p(5) -b(5)*x(9) - ((k(8)*(L(1) - x(-8) + x(8))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2)))/&
        &   Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2) + &
        &  (k(5)*(L(1) - x(-4) + x(8))*(-L(1) + Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2) + &
        &  (k(3)*(L(4) - x(0) + x(8))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) - &
        &  (k(7)*(L(1) - x(8) + x(16))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2)))/&
        &   Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2) - &
        &  (k(5)*(L(1) - x(8) + x(20))*(-L(1) + Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)))/&
        &   Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)) )/m(5)

        f(11) = x(11)

        f(12) = ( p(6) -b(6)*x(11) - (-((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &         Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2))*(L(2) + L(3) + x(-6) - x(10)))/&
        &     Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2)) + &
        &  (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) + &
        &  (k(5)*(-L(1) + Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2))*(-x(-2) + x(10)))/&
        &   Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2) - &
        &  (k(7)*(L(2) + L(3) - x(10) + x(18))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2)))/&
        &   Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2) + &
        &  (k(5)*(-L(1) + Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2))*(x(10) - x(22)))/&
        &   Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)) )/m(6)

    else if (BC_flag == 110) then
        f(1) = x(1)

        f(2) = ( p(1) - b(1)*x(1) - ((k(2)*(L(4) - x(0) + x(4))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(L(4) - x(0) + x(8))*(Sqrt(L(3)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - ((k(2)*(L(2) - x(2) + x(6))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) + &
        &  (k(1)*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2))*(x(2) - x(14)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) - b(3)*x(5) - ((k(2)*(L(4) - x(0) + x(4))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) - &
        &  (k(4)*(L(1) - x(4) + x(16))*(-L(1) + Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2)))/&
        &   Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2) - &
        &  (k(8)*(L(1) - x(4) + x(20))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)))/&
        &   Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)) )/m(3)

        f(7) = x(7)

        f(8) = ( p(4) - b(4)*x(7) - ((k(2)*(L(2) - x(2) + x(6))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) + &
        &  (k(4)*(-L(1) + Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2))*(x(6) - x(18)))/&
        &   Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2) + &
        &  (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2))*(L(2) + L(3) + x(6) - x(22)))/&
        &   Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)) )/m(4)

        f(9) = x(9)

        f(10) = ( p(5) - b(5)*x(9) - ((k(3)*(L(4) - x(0) + x(8))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) - &
        &  (k(7)*(L(1) - x(8) + x(16))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2)))/&
        &   Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2) - &
        &  (k(5)*(L(1) - x(8) + x(20))*(-L(1) + Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)))/&
        &   Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)) )/m(5)

        f(11) = x(11)

        f(12) = ( p(6) - b(6)*x(11) - ((k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) - &
        &  (k(7)*(L(2) + L(3) - x(10) + x(18))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2)))/&
        &   Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2) + &
        &  (k(5)*(-L(1) + Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2))*(x(10) - x(22)))/&
        &   Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)) )/m(6)

    else if (BC_flag == 111) then
        f(1) = x(1)
        
        f(2) = ( p(1) - b(1)*x(1) - ((k(2)*(L(4) - x(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
        &  (k(3)*(L(4) - x(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) - &
        &  (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - ((k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2))*(L(2) - x(2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
        &  (k(3)*(L(3) + x(2))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) + &
        &  (k(1)*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2))*(x(2) - x(14)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(2)

    else if (BC_flag == 112) then
        f(1) = x(1)
        
        f(2) = ( p(1) - b(1)*x(1) - ((k(2)*(L(4) - x(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
        &  (k(3)*(L(4) - x(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) - &
        &  (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

    else if (BC_flag == 120) then
        f(1) = x(1)

        f(2) = ( p(1) - b(1)*x(1) - ((k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(2)*(L(4) - x(0) + x(4))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(L(4) - x(0) + x(8))*(Sqrt(L(3)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - ((k(1)*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2))*(-x(-10) + x(2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(2)*(L(2) - x(2) + x(6))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) - b(3)*x(5) - ((k(4)*(L(1) - x(-8) + x(4))*(-L(1) + Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2)))/&
        &   Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2) + &
        &  (k(7)*(L(1) - x(-4) + x(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2) + &
        &  (k(2)*(L(4) - x(0) + x(4))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)) )/m(3)

        f(7) = x(7)

        f(8) = ( p(4) - b(4)*x(7) - ((k(4)*(-L(1) + Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2))*(-x(-6) + x(6)))/&
        &   Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2) + &
        &  (k(7)*(L(2) + L(3) - x(-2) + x(6))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2) + &
        &  (k(2)*(L(2) - x(2) + x(6))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)) )/m(4)

        f(9) = x(9)

        f(10) = ( p(5) - b(5)*x(9) - ((k(8)*(L(1) - x(-8) + x(8))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2)))/&
        &   Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2) + &
        &  (k(5)*(L(1) - x(-4) + x(8))*(-L(1) + Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2) + &
        &  (k(3)*(L(4) - x(0) + x(8))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)) )/m(5)

        f(11) = x(11)

        f(12) = ( p(6) - b(6)*x(11) - (-((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &         Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2))*(L(2) + L(3) + x(-6) - x(10)))/&
        &     Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2)) + &
        &  (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) + &
        &  (k(5)*(-L(1) + Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2))*(-x(-2) + x(10)))/&
        &   Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2)) )/m(6)

    else if (BC_flag == 121) then
        f(1) = x(1)
        
        f(2) = ( p(1) - b(1)*x(1) - ((k(2)*(L(4) - x(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
        &  (k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(3)*(L(4) - x(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - ((k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2))*(L(2) - x(2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
        &  (k(1)*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2))*(-x(-10) + x(2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(3)*(L(3) + x(2))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)) )/m(2)

    else if (BC_flag == 200) then
        f(1) = x(1)

        f(2) = ( p(1) - b(1)*x(1) - ((k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)))/&
            &Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
            &(k(3)*(L(4) - x(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) + &
            &(k(2)*(L(4) - x(0) + x(4))*(Sqrt(L(2)**2 + L(4)**2) - &
            &Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
            &Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) - &
            &(k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
            &Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) -(-((k(1)*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2))*(x(-10) - x(2)))/&
            &Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)) + &
            &(k(3)*(L(3) + x(2))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) + &
            &(k(2)*(L(2) - x(2) + x(6))*(Sqrt(L(2)**2 + L(4)**2) - &
            &Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
            &Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
            &(k(1)*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2))*(x(2) - x(14)))/&
            &Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) - b(3)*x(5) - ((k(4)*(L(1) - x(-8) + x(4))*(-L(1) + Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2)))/&
            &Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2) - &
            &(k(8)*(L(1) - x(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &Sqrt((L(1) - x(4))**2 + (L(2) + L(3) + x(6))**2)))/&
            &Sqrt((L(1) - x(4))**2 + (L(2) + L(3) + x(6))**2) + &
            &(k(6)*x(4)*(-L(2) - L(3) + Sqrt(x(4)**2 + (L(2) + L(3) + x(6))**2)))/&
            &Sqrt(x(4)**2 + (L(2) + L(3) + x(6))**2) + &
            &(k(7)*(L(1) + x(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &Sqrt((L(1) + x(4))**2 + (L(2) + L(3) + x(6))**2)))/&
            &Sqrt((L(1) + x(4))**2 + (L(2) + L(3) + x(6))**2) + &
            &(k(2)*(L(4) - x(0) + x(4))*(-Sqrt(L(2)**2 + L(4)**2) + &
            &Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
            &Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) - &
            &(k(4)*(L(1) - x(4) + x(16))*(-L(1) + Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2)))/&
            &Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2)) )/m(3)

        f(7) = x(7)

        f(8) = ( p(4) - b(4)*x(7) - (-((k(4)*(-L(1) + Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2))*(x(-6) - x(6)))/&
            &Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2)) + &
            &(k(8)*(L(2) + L(3) + x(6))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &Sqrt((L(1) - x(4))**2 + (L(2) + L(3) + x(6))**2)))/&
            &Sqrt((L(1) - x(4))**2 + (L(2) + L(3) + x(6))**2) + &
            &(k(6)*(L(2) + L(3) + x(6))*(-L(2) - L(3) + Sqrt(x(4)**2 + (L(2) + L(3) + x(6))**2)))/&
            &Sqrt(x(4)**2 + (L(2) + L(3) + x(6))**2) + &
            &(k(7)*(L(2) + L(3) + x(6))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &Sqrt((L(1) + x(4))**2 + (L(2) + L(3) + x(6))**2)))/&
            &Sqrt((L(1) + x(4))**2 + (L(2) + L(3) + x(6))**2) + &
            &(k(2)*(L(2) - x(2) + x(6))*(-Sqrt(L(2)**2 + L(4)**2) + &
            &Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
            &Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
            &(k(4)*(-L(1) + Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2))*(x(6) - x(18)))/&
            &Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2)) )/m(4)


    else if (BC_flag == 2112) then
        f(1) = x(1)

        f(2) = ( p(1) - b(1)*x(1) - ((k(3)*(L(4) - x(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) + &
            &(k(2)*(L(4) - x(0))*(Sqrt(L(2)**2 + L(4)**2) - &
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2) - &
            &(k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
            &Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) -((k(3)*(L(3) + x(2))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) + &
            &(k(2)*(L(2) - x(2) + x(6))*(Sqrt(L(2)**2 + L(4)**2) - &
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2) + &
            &(k(1)*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2))*(x(2) - x(14)))/&
            &Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(2)

        f(7) = x(7)

        f(8) = ( p(4) - b(4)*x(7) - ((k(6)*(L(2) + L(3) + x(6))*(-L(2) - L(3) + Sqrt((L(2) + L(3) + x(6))**2)))/&
            &Sqrt((L(2) + L(3) + x(6))**2) + &
            &(k(8)*(L(2) + L(3) + x(6))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &Sqrt(L(1)**2 + (L(2) + L(3) + x(6))**2)))/Sqrt(L(1)**2 + (L(2) + L(3) + x(6))**2) + &
            &(k(2)*(L(2) - x(2) + x(6))*(-Sqrt(L(2)**2 + L(4)**2) + &
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2) + &
            &(k(4)*(-L(1) + Sqrt((L(1) + x(16))**2 + (x(6) - x(18))**2))*(x(6) - x(18)))/&
            &Sqrt((L(1) + x(16))**2 + (x(6) - x(18))**2)) )/m(4)


    else if (BC_flag == 2212) then
        f(1) = x(1)

        f(2) = ( p(1) - b(1)*x(1) - ((k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)))/&
            &Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
            &(k(3)*(L(4) - x(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) + &
            &(k(2)*(L(4) - x(0))*(Sqrt(L(2)**2 + L(4)**2) - &
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) -(-((k(1)*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2))*(x(-10) - x(2)))/&
            &Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)) + &
            &(k(3)*(L(3) + x(2))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) + &
            &(k(2)*(L(2) - x(2) + x(6))*(Sqrt(L(2)**2 + L(4)**2) - &
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2)) )/m(2)

        f(7) = x(7)

        f(8) = ( p(4) - b(4)*x(7) - (-((k(4)*(-L(1) + Sqrt((L(1) - x(-8))**2 + (x(-6) - x(6))**2))*(x(-6) - x(6)))/&
            &Sqrt((L(1) - x(-8))**2 + (x(-6) - x(6))**2)) + &
            &(k(6)*(L(2) + L(3) + x(6))*(-L(2) - L(3) + Sqrt((L(2) + L(3) + x(6))**2)))/&
            &Sqrt((L(2) + L(3) + x(6))**2) + &
            &(k(7)*(L(2) + L(3) + x(6))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &Sqrt(L(1)**2 + (L(2) + L(3) + x(6))**2)))/Sqrt(L(1)**2 + (L(2) + L(3) + x(6))**2) + &
            &(k(2)*(L(2) - x(2) + x(6))*(-Sqrt(L(2)**2 + L(4)**2) + &
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2)))/&
            &Sqrt((L(4) - x(0))**2 + (L(2) - x(2) + x(6))**2)) )/m(4)


    else if (BC_flag == 700 .or. BC_flag == 710 .or. BC_flag == 720) then
        f(1) = x(1)

        f(2) = ( p(1)-b(1)*x(1) - ((k(2)*(L(4) - x(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2)))/&
            & Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
            & (k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)))/&
            & Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
            & (k(2)*(L(4) - x(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) + x(2))**2)))/&
            & Sqrt((L(4) - x(0))**2 + (L(2) + x(2))**2) - &
            & (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
            & Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2)-b(2)*x(3) - ((k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2))*(L(2) - x(2)))/&
            & Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) - &
            & (k(1)*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2))*(x(-10) - x(2)))/&
            & Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
            & (k(2)*(L(2) + x(2))*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - x(0))**2 + (L(2) + x(2))**2)))/&
            & Sqrt((L(4) - x(0))**2 + (L(2) + x(2))**2) + &
            & (k(1)*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2))*(x(2) - x(14)))/&
            & Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(2)


    else if (BC_flag == 800 .or. BC_flag == 810 .or. BC_flag == 820) then
        f(1) = x(1)

        f(2) = ( p(1) -b(1)*x(1) - ((-2*k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt(L(2)**2 + (L(4) - x(0))**2))*(L(4) - x(0)))/&
        &   Sqrt(L(2)**2 + (L(4) - x(0))**2) + (k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2) - (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2)) )/m(1)

    end if

    end subroutine calc_f_metabeam


    subroutine calc_f_pendula(BC_flag, lowerBound, upperBound, m, b, p, G, k, L, x, f)

    !! Data dictionary
    integer, intent(in) :: BC_flag
    integer, intent(in) :: lowerBound
    integer, intent(in) :: upperBound
    real, intent(in), dimension(2) :: m
    real, intent(in), dimension(1) :: b
    real, intent(in), dimension(1) :: p
    real, intent(in) :: G
    real, intent(in), dimension(1) :: k
    real, intent(in), dimension(1) :: L
    real, intent(in), dimension(lowerBound:upperBound) :: x
    real, intent(out), dimension(2) :: f

    if (BC_flag == 100) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (G*L(1)*m(2)*Sin(x(0)) - k(1)*x(-2) + 2*k(1)*x(0) - k(1)*x(2)) )/m(1)
    else if (BC_flag == 110) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (G*L(1)*m(2)*Sin(x(0)) + k(1)*(x(0) - x(2))) )/m(1)
    else if (BC_flag == 120) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (G*L(1)*m(2)*Sin(x(0)) - k(1)*x(-2) + k(1)*x(0)) )/m(1)
    else if (BC_flag == 121) then
        f(1) = 0.
        f(2) = 0.
    end if

    end subroutine calc_f_pendula


    subroutine calc_f_phi4(BC_flag, lowerBound, upperBound, m, b, p, k, x, f)

    !! Data dictionary
    integer, intent(in) :: BC_flag
    integer, intent(in) :: lowerBound
    integer, intent(in) :: upperBound
    real, intent(in), dimension(1) :: m
    real, intent(in), dimension(1) :: b
    real, intent(in), dimension(1) :: p
    real, intent(in), dimension(5) :: k
    real, intent(in), dimension(lowerBound:upperBound) :: x
    real, intent(out), dimension(2) :: f

    if (BC_flag == 100) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (k(2) - k(1)*x(-2) + 2*(k(1) + k(3))*x(0) + 3*k(4)*x(0)**2 + 4*k(5)*x(0)**3 - k(1)*x(2)) )/m(1)
    else if (BC_flag == 110) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (k(2) + k(1)*x(0) + 2*k(3)*x(0) + 3*k(4)*x(0)**2 + 4*k(5)*x(0)**3 - k(1)*x(2)) )/m(1)
    else if (BC_flag == 120) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (k(2) - k(1)*x(-2) + (k(1) + 2*k(3))*x(0) + 3*k(4)*x(0)**2 + 4*k(5)*x(0)**3) )/m(1)
    else if (BC_flag == 121) then
        f(1) = 0.
        f(2) = 0.
    end if

    end subroutine calc_f_phi4


    subroutine calc_load(LC_loc, LC_val_loc, c, t, dt, L, p_loc, x_loc)

    !! Data dictionary
    real, parameter :: PI=3.141592653589793
    integer, intent(in), dimension(3) :: LC_loc
    real, intent(in), dimension(7) :: LC_val_loc
    real, intent(in) :: c, t, dt
    real, intent(in), dimension(4) :: L
    real, intent(out) :: p_loc
    real, intent(out), dimension(2) :: x_loc

    if ( LC_loc(3) == 1 ) then
        if ( t >= LC_val_loc(1) .and. t <= LC_val_loc(2) ) then
            p_loc = LC_val_loc(3)*SIN(2*PI*LC_val_loc(4)*(t+c*dt) + LC_val_loc(5))
        end if
    else if ( LC_loc(3) == 2 ) then
        if ( t >= LC_val_loc(1) .and. t <= LC_val_loc(2) ) then
            p_loc = LC_val_loc(3)*SIN(2*PI*LC_val_loc(4)*(t+c*dt) + LC_val_loc(5))*&
                & SIN(PI*((t+c*dt)-LC_val_loc(6))/(LC_val_loc(7)-LC_val_loc(6)))**2
        end if
    else if ( LC_loc(3) == 11 ) then
        if ( t >= LC_val_loc(1) .and. t <= LC_val_loc(2) ) then
            x_loc(1) = LC_val_loc(3)*SIN(2*PI*LC_val_loc(4)*(t+c*dt) + LC_val_loc(5))
            x_loc(2) = 2*PI*LC_val_loc(4)*LC_val_loc(3)*COS(2*PI*LC_val_loc(4)*(t+c*dt) + LC_val_loc(5))
        end if
    else if (LC_loc(3) == 12) then
        if ( t >= LC_val_loc(1) .and. t <= LC_val_loc(2) ) then
            x_loc(1) = LC_val_loc(3)*SIN(2*PI*LC_val_loc(4)*(t+c*dt) + LC_val_loc(5))*&
                & SIN(PI*((t+c*dt)-LC_val_loc(1))/(LC_val_loc(2)-LC_val_loc(1)))**2
            x_loc(2) = 2*LC_val_loc(3)*PI*SIN(PI*((t+c*dt)-LC_val_loc(1))/(LC_val_loc(2)-LC_val_loc(1)))*&
                & ( LC_val_loc(4)*COS(2*PI*LC_val_loc(4)*(t+c*dt)+LC_val_loc(5))*&
                & SIN(PI*((t+c*dt)-LC_val_loc(1))/(LC_val_loc(2)-LC_val_loc(1)))+&
                & COS(PI*((t+c*dt)-LC_val_loc(1))/(LC_val_loc(2)-LC_val_loc(1)))*&
                & SIN(2*PI*LC_val_loc(4)*(t+c*dt)+LC_val_loc(5))/(LC_val_loc(2)-LC_val_loc(1)) )
        end if
    else if (LC_loc(3) == 13) then
        if ( t >= LC_val_loc(1) .and. t <= LC_val_loc(2) ) then
            x_loc(1) = L(4) - LC_val_loc(3)*COS(2*PI*LC_val_loc(4)*(t+c*dt) + LC_val_loc(5))
            x_loc(2) = 2*PI*LC_val_loc(4)*LC_val_loc(3)*SIN(2*PI*LC_val_loc(4)*(t+c*dt) + LC_val_loc(5))
        end if
    end if

    end subroutine calc_load

end module sub_rk
