module sub_NB

contains
    subroutine calc_fs(BC_flag, lowerBound, upperBound, u, k, L, fs)

    implicit none

    ! Data dictionary:
    integer, intent(in) :: BC_flag ! Boundary condition
    integer, intent(in) :: lowerBound !
    integer, intent(in) :: upperBound !
    real, intent(in), dimension(lowerBound:upperBound) :: u !
    real, intent(in), dimension(9) :: k !
    real, intent(in), dimension(4) :: L !
    real, intent(out), dimension(6) :: fs !

    ! Calculation for fs
    if (BC_flag == 100 .or. BC_flag == 300) then ! baseline, periodic
        fs(1) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        fs(2) = (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5)))/Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        fs(3) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(1) - u(-2) + u(2))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(8)*(L(1) - u(2) + u(10))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        fs(4) = (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(2) + L(3) - u(-1) + u(3))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*(L(2) + L(3) + u(3) - u(5)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11)))/&
        &  Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        fs(5) = (k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
        & (k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) + &
        & (k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(7)*(L(1) - u(4) + u(8))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
        & (k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        if (BC_flag == 100) then
            fs(6) = -((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
            &    Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)) + &
            & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
            &    (L(3) + u(1) - u(5)))/Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
            & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*(L(2) + L(3) + u(3) - u(5)))/&
            &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(-u(-1) + u(5)))/&
            &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) - &
            & (k(7)*(L(2) + L(3) - u(5) + u(9))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
            &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)
        else if (BC_flag == 300) then
            fs(6) = -((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
            &    Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)) + &
            & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
            &    (L(3) + u(1) - u(5)))/Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
            & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*(L(2) + L(3) + u(3) - u(5)))/&
            &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + k(9)*u(5) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(-u(-1) + u(5)))/&
            &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) - &
            & (k(7)*(L(2) + L(3) - u(5) + u(9))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
            &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)
        end if

    else if (BC_flag == 110) then ! baselie, left end free
        fs(1) = (k(2)*(L(4) - u(0) + u(2))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        fs(2) = (k(2)*(L(2) - u(1) + u(3))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5)))/Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        fs(3) = (k(2)*(L(4) - u(0) + u(2))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(8)*(L(1) - u(2) + u(10))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        fs(4) = (k(2)*(L(2) - u(1) + u(3))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*(L(2) + L(3) + u(3) - u(5)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11)))/&
        &  Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        fs(5) = (k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(7)*(L(1) - u(4) + u(8))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
        & (k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)
        
        fs(6) = (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5)))/Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*(L(2) + L(3) + u(3) - u(5)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(7)*(L(2) + L(3) - u(5) + u(9))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) + &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
        &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

    else if (BC_flag == 111 .or. BC_flag == 211) then ! Left end fixed
        fs(1) = (k(2)*(L(4) - u(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2) + &
        & (k(3)*(L(4) - u(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        fs(2) = (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2))*(L(2) - u(1)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2) + &
        & (k(3)*(L(3) + u(1))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        fs(3) = 0.

        fs(4) = 0.

        fs(5) = 0.

        fs(6) = 0.

    else if (BC_flag == 120) then ! baseline, right end free
        fs(1) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        fs(2) = (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5)))/Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        fs(3) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(1) - u(-2) + u(2))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        fs(4) = (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(2) + L(3) - u(-1) + u(3))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*(L(2) + L(3) + u(3) - u(5)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        fs(5) = (k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
        & (k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) + &
        & (k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        fs(6) = -((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
        &    Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)) + &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5)))/Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*(L(2) + L(3) + u(3) - u(5)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(-u(-1) + u(5)))/&
        &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

    else if (BC_flag == 121 .or. BC_flag == 221) then ! baseline, right end fixed
        fs(1) = (k(2)*(L(4) - u(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(4) - u(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)

        fs(2) = (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2))*(L(2) - u(1)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(3) + u(1))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)

        fs(3) = 0.
        
        fs(4) = 0.

        fs(5) = 0.
        
        fs(6) = 0.

    else if (BC_flag == 200) then ! bottom fixed, periodic
        fs(1) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(4) - u(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        fs(2) = (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(3) + u(1))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        fs(3) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) - &
        & (k(8)*(L(1) - u(2))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(6)*u(2)*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(1) + u(2))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        fs(4) = (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(8)*(L(2) + L(3) + u(3))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(6)*(L(2) + L(3) + u(3))*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(2) + L(3) + u(3))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        fs(5) = 0.

        fs(6) = 0.

    else if (BC_flag == 210) then ! bottom fixed, left end free
        fs(1) = (k(3)*(L(4) - u(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        fs(2) = (k(3)*(L(3) + u(1))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)
        
        fs(3) = -((k(8)*(L(1) - u(2))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &    Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)) + &
        & (k(6)*u(2)*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        fs(4) = (k(8)*(L(2) + L(3) + u(3))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(6)*(L(2) + L(3) + u(3))*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        fs(5) = 0.

        fs(6) = 0.

    else if (BC_flag == 220) then ! bottom fixed, right end free
        fs(1) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(4) - u(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        fs(2) = (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(3) + u(1))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        fs(3) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(6)*u(2)*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(1) + u(2))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        fs(4) = (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(6)*(L(2) + L(3) + u(3))*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(2) + L(3) + u(3))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        fs(5) = 0.

        fs(6) = 0.

    END IF

    end subroutine calc_fs



    !=============================================================================
    !=============================================================================
    subroutine calc_kThat(BC_flag, lowerBound, upperBound, u, k, L, a, kThat)

    implicit none
    ! Data dictionary:
    integer, intent(in) :: BC_flag ! Boundary condition
    integer, intent(in) :: lowerBound !
    integer, intent(in) :: upperBound !
    real, intent(in), dimension(lowerBound:upperBound) :: u !
    real, intent(in), dimension(9) :: k !
    real, intent(in), dimension(4) :: L !
    real, intent(in), dimension(6) :: a !
    real, intent(out), dimension(108) :: kThat !

    kThat = 0.
    if (BC_flag == 100 .or. BC_flag == 300) then ! baseline, periodic
        kThat(1)= (k(1)*(L(1) - u(-6) + u(0))**2*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))**2)/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(2) =  -((k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(u(-5) - u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(7) = -((k(1)*(L(1) - u(-6) + u(0))**2*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))**2)/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(L(4) - u(0) + u(4))**2*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(1)*(L(1) - u(0) + u(6))**2*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(8) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))*(u(-5) - u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(9) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(10) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(11) = -((k(3)*(L(4) - u(0) + u(4))**2*(Sqrt(L(3)**2 + L(4)**2) - &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) - &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(12) = (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(13) = (k(1)*(L(1) - u(0) + u(6))**2*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(14) = -((k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &    ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5) + &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(19) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(20) = -((k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &    Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 + &
        & (k(1)*(u(-5) - u(1))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(25) = -((k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(26) = (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(u(-5) - u(1))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7))**2)/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 + &
        & (k(1)*(u(1) - u(7))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(27) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(28) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(29) = -((k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(30) = -((k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &    Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(31) = -((k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &    ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5) + &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(32) = -((k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &    Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7))**2)/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(u(1) - u(7))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(39) = (k(4)*(L(1) - u(-4) + u(2))**2*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))**2)/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(40) = -((k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))*(u(-3) - u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)
        
        kThat(41) = -((k(7)*(L(1) - u(-2) + u(2))**2)/((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)) + &
        & (k(7)*(L(1) - u(-2) + u(2))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 - &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)

        kThat(42) = -((k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3)))/&
        &    ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)) + &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5

        kThat(43) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(44) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(45) = -((k(4)*(L(1) - u(-4) + u(2))**2*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))**2)/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(1) - u(-2) + u(2))**2)/((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(7)*(L(1) - u(-2) + u(2))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(4)*(L(1) - u(2) + u(8))**2*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 + &
        & (k(4)*(L(1) - u(2) + u(8))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(8)*(L(1) - u(2) + u(10))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 + &
        & (k(8)*(L(1) - u(2) + u(10))**2)/((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(46) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))*(u(-3) - u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(8)*(L(1) - u(2) + u(10))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 - &
        & (k(8)*(L(1) - u(2) + u(10))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(47) = (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(48) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(51) = (k(4)*(L(1) - u(2) + u(8))**2*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(52) = -((k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &    ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5) + &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(53) = (k(8)*(L(1) - u(2) + u(10))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 - &
        & (k(8)*(L(1) - u(2) + u(10))**2)/((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2) - &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(54) = -((k(8)*(L(1) - u(2) + u(10))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11)))/&
        &    ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5) + &
        & (k(8)*(L(1) - u(2) + u(10))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(57) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(58) = -((k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &    Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 + &
        & (k(4)*(u(-3) - u(3))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(59) = -((k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3)))/&
        &    ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)) + &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5

        kThat(60) = -((k(7)*(L(2) + L(3) - u(-1) + u(3))**2)/((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)) + &
        & (k(7)*(L(2) + L(3) - u(-1) + u(3))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 - &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)

        kThat(61) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(62) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(63) = -((k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(8)*(L(1) - u(2) + u(10))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 - &
        & (k(8)*(L(1) - u(2) + u(10))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(64) = (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(u(-3) - u(3))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(2) + L(3) - u(-1) + u(3))**2)/((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(7)*(L(2) + L(3) - u(-1) + u(3))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9))**2)/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 + &
        & (k(4)*(u(3) - u(9))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2) - &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11))**2)/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 + &
        & (k(8)*(L(2) + L(3) + u(3) - u(11))**2)/((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(65) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(66) = -((k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &    Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(69) = -((k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &    ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5) + &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(70) = -((k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &    Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9))**2)/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(u(3) - u(9))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(71) = -((k(8)*(L(1) - u(2) + u(10))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11)))/&
        &    ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5) + &
        & (k(8)*(L(1) - u(2) + u(10))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(72) = -((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &    Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11))**2)/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 - &
        & (k(8)*(L(2) + L(3) + u(3) - u(11))**2)/((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(75) = (k(8)*(L(1) - u(-4) + u(4))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 - &
        & (k(8)*(L(1) - u(-4) + u(4))**2)/((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) - &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)

        kThat(76) = -((k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
        &    ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5) + &
        & (k(8)*(L(1) - u(-4) + u(4))*(L(2) + L(3) + u(-3) - u(5)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)

        kThat(77) = (k(5)*(L(1) - u(-2) + u(4))**2*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 - &
        & (k(5)*(L(1) - u(-2) + u(4))**2)/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) - &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

        kThat(78) = -((k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(u(-1) - u(5)))/&
        &    ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5) + &
        & (k(5)*(L(1) - u(-2) + u(4))*(u(-1) - u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

        kThat(79) = (k(3)*(L(4) - u(0) + u(4))**2*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(80) = -((k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(81) = (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(82) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(83) = -((k(8)*(L(1) - u(-4) + u(4))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &    ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5) + &
        & (k(8)*(L(1) - u(-4) + u(4))**2)/((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) - &
        & (k(5)*(L(1) - u(-2) + u(4))**2*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 + &
        & (k(5)*(L(1) - u(-2) + u(4))**2)/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) + &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) - &
        & (k(3)*(L(4) - u(0) + u(4))**2*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(7)*(L(1) - u(4) + u(8))**2)/((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
        & (k(7)*(L(1) - u(4) + u(8))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
        & (k(5)*(L(1) - u(4) + u(10))**2*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 + &
        & (k(5)*(L(1) - u(4) + u(10))**2)/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2) + &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        kThat(84) = (k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 - &
        & (k(8)*(L(1) - u(-4) + u(4))*(L(2) + L(3) + u(-3) - u(5)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
        & (k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(u(-1) - u(5)))/&
        &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 - &
        & (k(5)*(L(1) - u(-2) + u(4))*(u(-1) - u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) + &
        & (k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
        & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 + &
        & (k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
        &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 - &
        & (k(5)*(L(1) - u(4) + u(10))*(u(5) - u(11)))/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        kThat(87) = -((k(7)*(L(1) - u(4) + u(8))**2)/((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)) + &
        & (k(7)*(L(1) - u(4) + u(8))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 - &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)

        kThat(88) = -((k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9)))/&
        &    ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)) + &
        & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5

        kThat(89) = (k(5)*(L(1) - u(4) + u(10))**2*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 - &
        & (k(5)*(L(1) - u(4) + u(10))**2)/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2) - &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        kThat(90) = -((k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
        &    ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5) + &
        & (k(5)*(L(1) - u(4) + u(10))*(u(5) - u(11)))/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        if (BC_flag == 100) then
            kThat(93) = -((k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
            &    ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5) + &
            & (k(8)*(L(1) - u(-4) + u(4))*(L(2) + L(3) + u(-3) - u(5)))/&
            &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)

            kThat(94) = -((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
            &    Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)) + &
            & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5))**2)/&
            &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 - &
            & (k(8)*(L(2) + L(3) + u(-3) - u(5))**2)/((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)

            kThat(95) = (k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(-u(-1) + u(5)))/&
            &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 - &
            & (k(5)*(L(1) - u(-2) + u(4))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

            kThat(96) = -((k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
            &    Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)) - &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(u(-1) - u(5))*(-u(-1) + u(5)))/&
            &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 + &
            & (k(5)*(u(-1) - u(5))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

            kThat(97) = (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
            &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
            &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
            & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

            kThat(98) = (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
            &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
            & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
            &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
            & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

            kThat(99) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
            &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
            & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

            kThat(100) = -((k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
            &    Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)) + &
            & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
            &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
            & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

            kThat(101) = (k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
            &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 - &
            & (k(8)*(L(1) - u(-4) + u(4))*(L(2) + L(3) + u(-3) - u(5)))/&
            &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) - &
            & (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
            &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
            &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
            & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
            & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
            &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
            & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
            & (k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(-u(-1) + u(5)))/&
            &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 + &
            & (k(5)*(L(1) - u(-2) + u(4))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) + &
            & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9)))/&
            &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
            & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9))*&
            &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 + &
            & (k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
            &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 - &
            & (k(5)*(L(1) - u(4) + u(10))*(u(5) - u(11)))/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

            kThat(102) = (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
            &  Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
            &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) - &
            & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
            &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
            & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
            &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
            & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5))**2)/&
            &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 + &
            & (k(8)*(L(2) + L(3) + u(-3) - u(5))**2)/((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
            & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
            &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
            & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
            & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
            &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
            & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(u(-1) - u(5))*(-u(-1) + u(5)))/&
            &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 - &
            & (k(5)*(u(-1) - u(5))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) + &
            & (k(7)*(L(2) + L(3) - u(5) + u(9))**2)/((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
            & (k(7)*(L(2) + L(3) - u(5) + u(9))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 + &
            & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
            &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2) - &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11))**2)/&
            &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 + &
            & (k(5)*(u(5) - u(11))**2)/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

            kThat(105) = -((k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9)))/&
            &    ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)) + &
            & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9))*&
            &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5

            kThat(106) = -((k(7)*(L(2) + L(3) - u(5) + u(9))**2)/((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)) + &
            & (k(7)*(L(2) + L(3) - u(5) + u(9))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 - &
            & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)

            kThat(107) = -((k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + & 
            & (u(5) - u(11))**2))*(u(5) - u(11)))/&
            &    ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5) + &
            & (k(5)*(L(1) - u(4) + u(10))*(u(5) - u(11)))/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

            kThat(108) = -((k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
            &    Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11))**2)/&
            &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 - &
            & (k(5)*(u(5) - u(11))**2)/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)
        else if (BC_flag == 300) then
            kThat(93) = -((k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
            &    ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5) + &
            & (k(8)*(L(1) - u(-4) + u(4))*(L(2) + L(3) + u(-3) - u(5)))/&
            &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)

            kThat(94) = -((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
            &    Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)) + &
            & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5))**2)/&
            &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 - &
            & (k(8)*(L(2) + L(3) + u(-3) - u(5))**2)/((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)

            kThat(95) = (k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(-u(-1) + u(5)))/&
            &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 - &
            & (k(5)*(L(1) - u(-2) + u(4))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

            kThat(96) = -((k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
            &    Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)) - &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(u(-1) - u(5))*(-u(-1) + u(5)))/&
            &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 + &
            & (k(5)*(u(-1) - u(5))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

            kThat(97) = (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
            &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
            &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
            & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

            kThat(98) = (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
            &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
            & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
            &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
            & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

            kThat(99) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
            &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
            & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

            kThat(100) = -((k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
            &    Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)) + &
            & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
            &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
            & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

            kThat(101) = (k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
            &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 - &
            & (k(8)*(L(1) - u(-4) + u(4))*(L(2) + L(3) + u(-3) - u(5)))/&
            &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) - &
            & (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
            &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
            &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
            & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
            & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
            &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
            & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
            & (k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(-u(-1) + u(5)))/&
            &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 + &
            & (k(5)*(L(1) - u(-2) + u(4))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) + &
            & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9)))/&
            &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
            & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9))*&
            &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 + &
            & (k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
            &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 - &
            & (k(5)*(L(1) - u(4) + u(10))*(u(5) - u(11)))/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

            kThat(102) =  k(9) + (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
            &  Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
            &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) - &
            & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
            &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
            & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
            &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
            & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5))**2)/&
            &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 + &
            & (k(8)*(L(2) + L(3) + u(-3) - u(5))**2)/((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
            & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
            &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
            & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
            & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
            &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
            & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(u(-1) - u(5))*(-u(-1) + u(5)))/&
            &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 - &
            & (k(5)*(u(-1) - u(5))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) + &
            & (k(7)*(L(2) + L(3) - u(5) + u(9))**2)/((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
            & (k(7)*(L(2) + L(3) - u(5) + u(9))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 + &
            & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
            &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2) - &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11))**2)/&
            &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 + &
            & (k(5)*(u(5) - u(11))**2)/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

            kThat(105) = -((k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9)))/&
            &    ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)) + &
            & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9))*&
            &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5

            kThat(106) = -((k(7)*(L(2) + L(3) - u(5) + u(9))**2)/((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)) + &
            & (k(7)*(L(2) + L(3) - u(5) + u(9))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
            &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 - &
            & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
            &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)

            kThat(107) = -((k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + &
            & (u(5) - u(11))**2))*(u(5) - u(11)))/&
            &    ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5) + &
            & (k(5)*(L(1) - u(4) + u(10))*(u(5) - u(11)))/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

            kThat(108) = -((k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
            &    Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)) + &
            & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11))**2)/&
            &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 - &
            & (k(5)*(u(5) - u(11))**2)/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)
        end if

    else if (BC_flag == 110) then ! baseline, left end free
        kThat(7) = (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(L(4) - u(0) + u(4))**2*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(1)*(L(1) - u(0) + u(6))**2*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(8) = (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(9) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(10) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(11) = -((k(3)*(L(4) - u(0) + u(4))**2*(Sqrt(L(3)**2 + L(4)**2) - &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) - &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(12) = (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(13) = (k(1)*(L(1) - u(0) + u(6))**2*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(14) = -((k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &    ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5) + &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(25) = (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(26) = (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7))**2)/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 + &
        & (k(1)*(u(1) - u(7))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(27) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(28) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(29) = -((k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(30) = -((k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &    Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(31) = -((k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &    ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5) + &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(32) = -((k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &    Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7))**2)/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(u(1) - u(7))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(43) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(44) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(45) = (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(4)*(L(1) - u(2) + u(8))**2*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 + &
        & (k(4)*(L(1) - u(2) + u(8))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(8)*(L(1) - u(2) + u(10))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 + &
        & (k(8)*(L(1) - u(2) + u(10))**2)/((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(46) = (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(8)*(L(1) - u(2) + u(10))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 - &
        & (k(8)*(L(1) - u(2) + u(10))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(47) = (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(48) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(51) = (k(4)*(L(1) - u(2) + u(8))**2*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(52) = -((k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &    ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5) + &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(53) = (k(8)*(L(1) - u(2) + u(10))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 - &
        & (k(8)*(L(1) - u(2) + u(10))**2)/((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2) - &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(54) = -((k(8)*(L(1) - u(2) + u(10))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11)))/&
        &    ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5) + &
        & (k(8)*(L(1) - u(2) + u(10))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(61) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(62) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(63) = (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(8)*(L(1) - u(2) + u(10))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 - &
        & (k(8)*(L(1) - u(2) + u(10))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(64) = (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9))**2)/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 + &
        & (k(4)*(u(3) - u(9))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &  Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2) - &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11))**2)/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 + &
        & (k(8)*(L(2) + L(3) + u(3) - u(11))**2)/((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(65) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(66) = -((k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &    Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(69) = -((k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &    ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5) + &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(70) = -((k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &    Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9))**2)/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(u(3) - u(9))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(71) = -((k(8)*(L(1) - u(2) + u(10))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11)))/&
        &    ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5) + &
        & (k(8)*(L(1) - u(2) + u(10))*(L(2) + L(3) + u(3) - u(11)))/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(72) = -((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)))/&
        &    Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2))*(L(2) + L(3) + u(3) - u(11))**2)/&
        &  ((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)**1.5 - &
        & (k(8)*(L(2) + L(3) + u(3) - u(11))**2)/((L(1) - u(2) + u(10))**2 + (L(2) + L(3) + u(3) - u(11))**2)

        kThat(79) = (k(3)*(L(4) - u(0) + u(4))**2*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(80) = -((k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(81) = (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(82) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(83) =  -((k(3)*(L(4) - u(0) + u(4))**2*(-Sqrt(L(3)**2 + L(4)**2) + &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) + &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(7)*(L(1) - u(4) + u(8))**2)/((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
        & (k(7)*(L(1) - u(4) + u(8))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
        & (k(5)*(L(1) - u(4) + u(10))**2*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 + &
        & (k(5)*(L(1) - u(4) + u(10))**2)/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2) + &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        kThat(84) = (k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
        & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 + &
        & (k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
        &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 - &
        & (k(5)*(L(1) - u(4) + u(10))*(u(5) - u(11)))/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        kThat(87) = -((k(7)*(L(1) - u(4) + u(8))**2)/((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)) + &
        & (k(7)*(L(1) - u(4) + u(8))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 - &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)

        kThat(88) = -((k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9)))/&
        &    ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)) + &
        & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5

        kThat(89) = (k(5)*(L(1) - u(4) + u(10))**2*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 - &
        & (k(5)*(L(1) - u(4) + u(10))**2)/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2) - &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        kThat(90) = -((k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
        &    ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5) + &
        & (k(5)*(L(1) - u(4) + u(10))*(u(5) - u(11)))/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        kThat(97) = (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(98) = (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(99) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(100) = -((k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &    Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(101) = -((k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
        & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 + &
        & (k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
        &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 - &
        & (k(5)*(L(1) - u(4) + u(10))*(u(5) - u(11)))/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        kThat(102) = -((k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &    Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(7)*(L(2) + L(3) - u(5) + u(9))**2)/((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) - &
        & (k(7)*(L(2) + L(3) - u(5) + u(9))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2) + &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &  Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2) - &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11))**2)/&
        &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 + &
        & (k(5)*(u(5) - u(11))**2)/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        kThat(105) = -((k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9)))/&
        &    ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)) + &
        & (k(7)*(L(1) - u(4) + u(8))*(L(2) + L(3) - u(5) + u(9))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5

        kThat(106) = -((k(7)*(L(2) + L(3) - u(5) + u(9))**2)/((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)) + &
        & (k(7)*(L(2) + L(3) - u(5) + u(9))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  ((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)**1.5 - &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)))/&
        &  Sqrt((L(1) - u(4) + u(8))**2 + (L(2) + L(3) - u(5) + u(9))**2)

        kThat(107) = -((k(5)*(L(1) - u(4) + u(10))*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11)))/&
        &    ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5) + &
        & (k(5)*(L(1) - u(4) + u(10))*(u(5) - u(11)))/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

        kThat(108) = -((k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)))/&
        &    Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)) + &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2))*(u(5) - u(11))**2)/&
        &  ((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)**1.5 - &
        & (k(5)*(u(5) - u(11))**2)/((L(1) - u(4) + u(10))**2 + (u(5) - u(11))**2)

    else if (BC_flag == 111 .or. BC_flag == 211) then ! baseline, left end fixed
        kThat(7) = (k(2)*(L(4) - u(0))**2*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(2) - u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0))**2)/((L(4) - u(0))**2 + (L(2) - u(1))**2) - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2) + &
        & (k(3)*(L(4) - u(0))**2)/((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(3)*(L(4) - u(0))**2*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(1)*(L(1) - u(0) + u(6))**2*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(8) = (k(2)*(L(4) - u(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2))*(L(2) - u(1)))/&
        &  ((L(4) - u(0))**2 + (L(2) - u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0))*(L(2) - u(1)))/((L(4) - u(0))**2 + (L(2) - u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1)))/((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(13) = (k(1)*(L(1) - u(0) + u(6))**2*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(14) = -((k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &    ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5) + &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(25) = (k(2)*(L(4) - u(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2))*(L(2) - u(1)))/&
        &  ((L(4) - u(0))**2 + (L(2) - u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0))*(L(2) - u(1)))/((L(4) - u(0))**2 + (L(2) - u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1)))/((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(26) = -((k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2)))/&
        &    Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2)) + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2))*(L(2) - u(1))**2)/&
        &  ((L(4) - u(0))**2 + (L(2) - u(1))**2)**1.5 + &
        & (k(2)*(L(2) - u(1))**2)/((L(4) - u(0))**2 + (L(2) - u(1))**2) + &
        & (k(3)*(L(3) + u(1))**2)/((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(3)*(L(3) + u(1))**2*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7))**2)/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 + &
        & (k(1)*(u(1) - u(7))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(31) = -((k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &    ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5) + &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(32) = -((k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &    Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7))**2)/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(u(1) - u(7))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

    else if (BC_flag == 120) then ! baseline, right end free
        kThat(1) = (k(1)*(L(1) - u(-6) + u(0))**2*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))**2)/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(2) = -((k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(u(-5) - u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(7) = -((k(1)*(L(1) - u(-6) + u(0))**2*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))**2)/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(L(4) - u(0) + u(4))**2*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(8) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))*(u(-5) - u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(9) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(10) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(11) = -((k(3)*(L(4) - u(0) + u(4))**2*(Sqrt(L(3)**2 + L(4)**2) - &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) - &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(12) = (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(19) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(20) = -((k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &    Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 + &
        & (k(1)*(u(-5) - u(1))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(25) = -((k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(26) = (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(u(-5) - u(1))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(27) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(28) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(29) = -((k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(30) = -((k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &    Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(39) = (k(4)*(L(1) - u(-4) + u(2))**2*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))**2)/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(40) = -((k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))*(u(-3) - u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(41) = -((k(7)*(L(1) - u(-2) + u(2))**2)/((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)) + &
        & (k(7)*(L(1) - u(-2) + u(2))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 - &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)

        kThat(42) = -((k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3)))/&
        &    ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)) + &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5

        kThat(43) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(44) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(45) = -((k(4)*(L(1) - u(-4) + u(2))**2*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))**2)/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(1) - u(-2) + u(2))**2)/((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(7)*(L(1) - u(-2) + u(2))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(46) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))*(u(-3) - u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(47) = (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(48) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(57) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(58) = -((k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &    Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 + &
        & (k(4)*(u(-3) - u(3))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(59) = -((k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3)))/&
        &    ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)) + &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5

        kThat(60) = -((k(7)*(L(2) + L(3) - u(-1) + u(3))**2)/((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)) + &
        & (k(7)*(L(2) + L(3) - u(-1) + u(3))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 - &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)

        kThat(61) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(62) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(63) = -((k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(7)*(L(1) - u(-2) + u(2))*(L(2) + L(3) - u(-1) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(64) = (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(u(-3) - u(3))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(7)*(L(2) + L(3) - u(-1) + u(3))**2)/((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(7)*(L(2) + L(3) - u(-1) + u(3))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  ((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(2))**2 + (L(2) + L(3) - u(-1) + u(3))**2) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(65) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(66) = -((k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &    Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(75) = (k(8)*(L(1) - u(-4) + u(4))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 - &
        & (k(8)*(L(1) - u(-4) + u(4))**2)/((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) - &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)

        kThat(76) = -((k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
        &    ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5) + &
        & (k(8)*(L(1) - u(-4) + u(4))*(L(2) + L(3) + u(-3) - u(5)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)

        kThat(77) = (k(5)*(L(1) - u(-2) + u(4))**2*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 - &
        & (k(5)*(L(1) - u(-2) + u(4))**2)/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) - &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

        kThat(78) = -((k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(u(-1) - u(5)))/&
        &    ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5) + &
        & (k(5)*(L(1) - u(-2) + u(4))*(u(-1) - u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

        kThat(79) = (k(3)*(L(4) - u(0) + u(4))**2*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(80) = -((k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &        Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &    ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5) + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(81) = (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(82) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(83) = -((k(8)*(L(1) - u(-4) + u(4))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &    ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5) + &
        & (k(8)*(L(1) - u(-4) + u(4))**2)/((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) - &
        & (k(5)*(L(1) - u(-2) + u(4))**2*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 + &
        & (k(5)*(L(1) - u(-2) + u(4))**2)/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) + &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) - &
        & (k(3)*(L(4) - u(0) + u(4))**2*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))**2*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  ((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(84) = (k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 - &
        & (k(8)*(L(1) - u(-4) + u(4))*(L(2) + L(3) + u(-3) - u(5)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
        & (k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(u(-1) - u(5)))/&
        &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 - &
        & (k(5)*(L(1) - u(-2) + u(4))*(u(-1) - u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) + &
        & (k(3)*(L(4) - u(0) + u(4))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(93) = -((k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
        &    ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5) + &
        & (k(8)*(L(1) - u(-4) + u(4))*(L(2) + L(3) + u(-3) - u(5)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)

        kThat(94) = -((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &        Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &    Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)) + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5))**2)/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 - &
        & (k(8)*(L(2) + L(3) + u(-3) - u(5))**2)/((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)

        kThat(95) = (k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(-u(-1) + u(5)))/&
        &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 - &
        & (k(5)*(L(1) - u(-2) + u(4))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

        kThat(96) = -((k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &    Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)) - &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(u(-1) - u(5))*(-u(-1) + u(5)))/&
        &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 + &
        & (k(5)*(u(-1) - u(5))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

        kThat(97) = (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(98) = (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)

        kThat(99) = (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(100) = -((k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &    Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 - &
        & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)

        kThat(101) = (k(8)*(L(1) - u(-4) + u(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 - &
        & (k(8)*(L(1) - u(-4) + u(4))*(L(2) + L(3) + u(-3) - u(5)))/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) - &
        & (k(3)*(L(4) - u(0) + u(4))*(Sqrt(L(3)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*(L(3) + u(1) - u(5)))/&
        &  ((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 - &
        & (k(3)*(L(4) - u(0) + u(4))*(L(3) + u(1) - u(5)))/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(u(2) - u(4))*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(u(2) - u(4))*(L(2) + L(3) + u(3) - u(5)))/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(5)*(L(1) - u(-2) + u(4))*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(-u(-1) + u(5)))/&
        &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 + &
        & (k(5)*(L(1) - u(-2) + u(4))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

        kThat(102) = (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)))/&
        &  Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2) - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)))/&
        &  Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) + &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)))/&
        &  Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) - &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2))*(L(2) + L(3) + u(-3) - u(5))**2)/&
        &  ((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2)**1.5 + &
        & (k(8)*(L(2) + L(3) + u(-3) - u(5))**2)/((L(1) - u(-4) + u(4))**2 + (L(2) + L(3) + u(-3) - u(5))**2) + &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2))*&
        &    (L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2)**1.5 + &
        & (k(3)*(L(3) + u(1) - u(5))**2)/((L(4) - u(0) + u(4))**2 + (L(3) + u(1) - u(5))**2) - &
        & (k(6)*(-L(2) - L(3) + Sqrt((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2))*&
        &    (L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2)**1.5 + &
        & (k(6)*(L(2) + L(3) + u(3) - u(5))**2)/((u(2) - u(4))**2 + (L(2) + L(3) + u(3) - u(5))**2) + &
        & (k(5)*(-L(1) + Sqrt((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2))*(u(-1) - u(5))*(-u(-1) + u(5)))/&
        &  ((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)**1.5 - &
        & (k(5)*(u(-1) - u(5))*(-u(-1) + u(5)))/((L(1) - u(-2) + u(4))**2 + (u(-1) - u(5))**2)

    else if (BC_flag == 121 .or. BC_flag == 221) then ! baseline, right end fixed
        kThat(1) = (k(1)*(L(1) - u(-6) + u(0))**2*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))**2)/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(2) = -((k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(u(-5) - u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(7) = (k(2)*(L(4) - u(0))**2*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(2) - u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0))**2)/((L(4) - u(0))**2 + (L(2) - u(1))**2) - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2) - &
        & (k(1)*(L(1) - u(-6) + u(0))**2*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 + &
        & (k(1)*(L(1) - u(-6) + u(0))**2)/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(4) - u(0))**2)/((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(3)*(L(4) - u(0))**2*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)

        kThat(8) = (k(2)*(L(4) - u(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2))*(L(2) - u(1)))/&
        &  ((L(4) - u(0))**2 + (L(2) - u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0))*(L(2) - u(1)))/((L(4) - u(0))**2 + (L(2) - u(1))**2) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))*(u(-5) - u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1)))/((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5

        kThat(19) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(20) = -((k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &    Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 + &
        & (k(1)*(u(-5) - u(1))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(25) = (k(2)*(L(4) - u(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2))*(L(2) - u(1)))/&
        &  ((L(4) - u(0))**2 + (L(2) - u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0))*(L(2) - u(1)))/((L(4) - u(0))**2 + (L(2) - u(1))**2) - &
        & (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 + &
        & (k(1)*(L(1) - u(-6) + u(0))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1)))/((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5

        kThat(26) = -((k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2)))/&
        &    Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2)) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(2) - u(1))**2))*(L(2) - u(1))**2)/&
        &  ((L(4) - u(0))**2 + (L(2) - u(1))**2)**1.5 + &
        & (k(2)*(L(2) - u(1))**2)/((L(4) - u(0))**2 + (L(2) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(u(-5) - u(1))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(3) + u(1))**2)/((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(3)*(L(3) + u(1))**2*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)

    else if (BC_flag == 200) then ! bottom fixed, periodic
        kThat(1) = (k(1)*(L(1) - u(-6) + u(0))**2*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))**2)/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(2) = -((k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(u(-5) - u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(7) = -((k(1)*(L(1) - u(-6) + u(0))**2*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))**2)/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(4) - u(0))**2)/((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(3)*(L(4) - u(0))**2*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(1)*(L(1) - u(0) + u(6))**2*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(8) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))*(u(-5) - u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1)))/((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(9) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(10) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(13) = (k(1)*(L(1) - u(0) + u(6))**2*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(14) = -((k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &    ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5) + &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(19) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(20) = -((k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &    Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 + &
        & (k(1)*(u(-5) - u(1))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(25) = -((k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1)))/((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(26) = (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(u(-5) - u(1))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(3) + u(1))**2)/((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(3)*(L(3) + u(1))**2*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7))**2)/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 + &
        & (k(1)*(u(1) - u(7))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(27) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(28) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(31) = -((k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &    ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5) + &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(32) = -((k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &    Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7))**2)/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(u(1) - u(7))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(39) = (k(4)*(L(1) - u(-4) + u(2))**2*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))**2)/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(40) = -((k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))*(u(-3) - u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(43) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(44) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(45) = -((k(4)*(L(1) - u(-4) + u(2))**2*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))**2)/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(8)*(L(1) - u(2))**2)/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(6)*u(2)**2)/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(1) + u(2))**2)/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(8)*(L(1) - u(2))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(6)*u(2)**2*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(6)*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(7)*(L(1) + u(2))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(4)*(L(1) - u(2) + u(8))**2*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 + &
        & (k(4)*(L(1) - u(2) + u(8))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(46) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))*(u(-3) - u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) - &
        & (k(8)*(L(1) - u(2))*(L(2) + L(3) + u(3)))/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(6)*u(2)*(L(2) + L(3) + u(3)))/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(1) + u(2))*(L(2) + L(3) + u(3)))/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(8)*(L(1) - u(2))*(L(2) + L(3) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  ((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(6)*u(2)*(L(2) + L(3) + u(3))*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(7)*(L(1) + u(2))*(L(2) + L(3) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  ((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(51) = (k(4)*(L(1) - u(2) + u(8))**2*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(52) = -((k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &    ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5) + &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(57) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(58) = -((k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &    Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 + &
        & (k(4)*(u(-3) - u(3))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(61) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(62) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(63) = -((k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) - &
        & (k(8)*(L(1) - u(2))*(L(2) + L(3) + u(3)))/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(6)*u(2)*(L(2) + L(3) + u(3)))/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(1) + u(2))*(L(2) + L(3) + u(3)))/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(8)*(L(1) - u(2))*(L(2) + L(3) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  ((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(6)*u(2)*(L(2) + L(3) + u(3))*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(7)*(L(1) + u(2))*(L(2) + L(3) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  ((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(64) = (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(u(-3) - u(3))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(8)*(L(2) + L(3) + u(3))**2)/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(6)*(L(2) + L(3) + u(3))**2)/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(2) + L(3) + u(3))**2)/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(8)*(L(2) + L(3) + u(3))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(6)*(L(2) + L(3) + u(3))**2*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(6)*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(7)*(L(2) + L(3) + u(3))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9))**2)/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 + &
        & (k(4)*(u(3) - u(9))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(69) = -((k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &    ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5) + &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(70) = -((k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &    Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9))**2)/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(u(3) - u(9))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

    else if (BC_flag == 210) then ! bottom fixed, left end free
        kThat(7) = (k(3)*(L(4) - u(0))**2)/((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(3)*(L(4) - u(0))**2*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(1)*(L(1) - u(0) + u(6))**2*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(8) = -((k(3)*(L(4) - u(0))*(L(3) + u(1)))/((L(4) - u(0))**2 + (L(3) + u(1))**2)) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(9) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(10) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(13) = (k(1)*(L(1) - u(0) + u(6))**2*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(14) = -((k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &    ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5) + &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(25) = -((k(3)*(L(4) - u(0))*(L(3) + u(1)))/((L(4) - u(0))**2 + (L(3) + u(1))**2)) + &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(26) = (k(3)*(L(3) + u(1))**2)/((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(3)*(L(3) + u(1))**2*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &  Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7))**2)/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 + &
        & (k(1)*(u(1) - u(7))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(27) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(28) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(31) = -((k(1)*(L(1) - u(0) + u(6))*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7)))/&
        &    ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5) + &
        & (k(1)*(L(1) - u(0) + u(6))*(u(1) - u(7)))/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(32) = -((k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)))/&
        &    Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2))*(u(1) - u(7))**2)/&
        &  ((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)**1.5 - &
        & (k(1)*(u(1) - u(7))**2)/((L(1) - u(0) + u(6))**2 + (u(1) - u(7))**2)

        kThat(43) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(44) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(45) = (k(8)*(L(1) - u(2))**2)/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(6)*u(2)**2)/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(8)*(L(1) - u(2))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(6)*u(2)**2*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(6)*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(4)*(L(1) - u(2) + u(8))**2*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 + &
        & (k(4)*(L(1) - u(2) + u(8))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(46) = -((k(8)*(L(1) - u(2))*(L(2) + L(3) + u(3)))/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)) + &
        & (k(6)*u(2)*(L(2) + L(3) + u(3)))/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(8)*(L(1) - u(2))*(L(2) + L(3) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  ((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(6)*u(2)*(L(2) + L(3) + u(3))*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(51) = (k(4)*(L(1) - u(2) + u(8))**2*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(52) = -((k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &    ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5) + &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(61) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(62) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(63) = -((k(8)*(L(1) - u(2))*(L(2) + L(3) + u(3)))/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)) + &
        & (k(6)*u(2)*(L(2) + L(3) + u(3)))/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(8)*(L(1) - u(2))*(L(2) + L(3) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  ((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(6)*u(2)*(L(2) + L(3) + u(3))*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(64) = (k(8)*(L(2) + L(3) + u(3))**2)/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(6)*(L(2) + L(3) + u(3))**2)/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(8)*(L(2) + L(3) + u(3))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) - u(2))**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(6)*(L(2) + L(3) + u(3))**2*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(6)*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &  Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9))**2)/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 + &
        & (k(4)*(u(3) - u(9))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(69) = -((k(4)*(L(1) - u(2) + u(8))*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9)))/&
        &    ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5) + &
        & (k(4)*(L(1) - u(2) + u(8))*(u(3) - u(9)))/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

        kThat(70) = -((k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)))/&
        &    Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2))*(u(3) - u(9))**2)/&
        &  ((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)**1.5 - &
        & (k(4)*(u(3) - u(9))**2)/((L(1) - u(2) + u(8))**2 + (u(3) - u(9))**2)

    else if (BC_flag == 220) then ! bottom fixed, right end free
        kThat(1) = (k(1)*(L(1) - u(-6) + u(0))**2*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))**2)/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(2) = -((k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(u(-5) - u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(7) = -((k(1)*(L(1) - u(-6) + u(0))**2*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))**2)/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(4) - u(0))**2)/((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(3)*(L(4) - u(0))**2*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 - &
        & (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(8) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))*(u(-5) - u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1)))/((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(9) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(10) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(19) = (k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(L(1) - u(-6) + u(0))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(20) = -((k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &    Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)) - &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 + &
        & (k(1)*(u(-5) - u(1))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)

        kThat(25) = -((k(1)*(L(1) - u(-6) + u(0))*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(-u(-5) + u(1)))/&
        &    ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5) + &
        & (k(1)*(L(1) - u(-6) + u(0))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) - &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1)))/((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(3)*(L(4) - u(0))*(L(3) + u(1))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(26) = (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)))/&
        &  Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(1)*(-L(1) + Sqrt((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2))*(u(-5) - u(1))*(-u(-5) + u(1)))/&
        &  ((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2)**1.5 - &
        & (k(1)*(u(-5) - u(1))*(-u(-5) + u(1)))/((L(1) - u(-6) + u(0))**2 + (u(-5) - u(1))**2) + &
        & (k(3)*(L(3) + u(1))**2)/((L(4) - u(0))**2 + (L(3) + u(1))**2) - &
        & (k(3)*(L(3) + u(1))**2*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  ((L(4) - u(0))**2 + (L(3) + u(1))**2)**1.5 + &
        & (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2)))/&
        &  Sqrt((L(4) - u(0))**2 + (L(3) + u(1))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(27) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(28) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(Sqrt(L(2)**2 + L(4)**2) - &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(39) = (k(4)*(L(1) - u(-4) + u(2))**2*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))**2)/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(40) = -((k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))*(u(-3) - u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(43) = -((k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(44) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(45) = -((k(4)*(L(1) - u(-4) + u(2))**2*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))**2)/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + (k(6)*u(2)**2)/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(1) + u(2))**2)/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(6)*u(2)**2*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(6)*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(7)*(L(1) + u(2))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(2)*(L(4) - u(0) + u(2))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(46) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))*(u(-3) - u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(6)*u(2)*(L(2) + L(3) + u(3)))/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(1) + u(2))*(L(2) + L(3) + u(3)))/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(6)*u(2)*(L(2) + L(3) + u(3))*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(7)*(L(1) + u(2))*(L(2) + L(3) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  ((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(57) = (k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(L(1) - u(-4) + u(2))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(58) = -((k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &    Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)) - &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 + &
        & (k(4)*(u(-3) - u(3))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)

        kThat(61) = -((k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(62) = -((k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)) + &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 - &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

        kThat(63) = -((k(4)*(L(1) - u(-4) + u(2))*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(-u(-3) + u(3)))/&
        &    ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5) + &
        & (k(4)*(L(1) - u(-4) + u(2))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(6)*u(2)*(L(2) + L(3) + u(3)))/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(1) + u(2))*(L(2) + L(3) + u(3)))/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3)))/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(6)*u(2)*(L(2) + L(3) + u(3))*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(7)*(L(1) + u(2))*(L(2) + L(3) + u(3))*&
        &    (-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  ((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 - &
        & (k(2)*(L(4) - u(0) + u(2))*(L(2) - u(1) + u(3))*&
        &    (-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5

        kThat(64) = (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)))/&
        &  Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(4)*(-L(1) + Sqrt((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2))*(u(-3) - u(3))*(-u(-3) + u(3)))/&
        &  ((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2)**1.5 - &
        & (k(4)*(u(-3) - u(3))*(-u(-3) + u(3)))/((L(1) - u(-4) + u(2))**2 + (u(-3) - u(3))**2) + &
        & (k(6)*(L(2) + L(3) + u(3))**2)/(u(2)**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(7)*(L(2) + L(3) + u(3))**2)/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) + &
        & (k(2)*(L(2) - u(1) + u(3))**2)/((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2) - &
        & (k(6)*(L(2) + L(3) + u(3))**2*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/&
        &  (u(2)**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(6)*(-L(2) - L(3) + Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2)))/Sqrt(u(2)**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(7)*(L(2) + L(3) + u(3))**2*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &      Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)**1.5 + &
        & (k(7)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2)))/&
        &  Sqrt((L(1) + u(2))**2 + (L(2) + L(3) + u(3))**2) - &
        & (k(2)*(L(2) - u(1) + u(3))**2*(-Sqrt(L(2)**2 + L(4)**2) + &
        &      Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  ((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)**1.5 + &
        & (k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)))/&
        &  Sqrt((L(4) - u(0) + u(2))**2 + (L(2) - u(1) + u(3))**2)

    end if

    kThat(7) = kThat(7) + a(1)
    kThat(26) = kThat(26) + a(2)
    kThat(45) = kThat(45) + a(3)
    kThat(64) = kThat(64) + a(4)
    kThat(83) = kThat(83) + a(5)
    kThat(102) = kThat(102) + a(6)


    end subroutine calc_kThat



    !=============================================================================
    !=============================================================================
    subroutine calc_du(N_inv, tol_inv, N_loc, procID, noProc, kThat, res, du, nt_it, cnt_inv, t_inv_total)

    use mpi
    implicit none

    ! Data dictionary:
    integer, intent(in) :: N_inv ! max number of itertations for matrix inversion
    real, intent(in) :: tol_inv !
    integer, intent(in) :: n_loc ! No. of unit cells per process
    integer, intent(in) :: procID, noProc
    real, intent(in), dimension(18*6*N_loc) :: kThat !
    real, intent(in), dimension(6*N_loc) :: res !
    real, intent(out), dimension(6*(N_loc+2)) :: du !
    integer, intent(in) :: nt_it
    integer, intent(inout) :: cnt_inv
    real, intent(inout) :: t_inv_total
    ! Data dictionary:
    integer :: ierr, status(MPI_STATUS_SIZE)
    real, dimension(6*(N_loc+2)) :: d
    real, dimension(6*N_loc) :: g
    real, dimension(6*N_loc) :: t
    real, dimension(2) :: dn1_loc, dn2_loc 
    real, dimension(2) :: dn1, dn2
    real :: s
    integer :: it, it2, it3, ind, ind2
    real :: t_inv_start, t_inv_end

    call MPI_BARRIER(MPI_COMM_WORLD, ierr)
    t_inv_start = MPI_WTIME()

    d = 0.
    du = 0.
    g = -res
    do it = 1, N_inv
        if (procID == 0 .and. it == N_inv) then
            write (*,*) "WARNING: Max number of iterations for matrix inversion reached at ", nt_it, "th iteration."
            write (*,*) "n1 is ", dn1(2)
        end if
        dn1_loc = 0.
        dn2_loc = 0.
        do it2 = 1, 6*N_loc
            dn1_loc(1) = dn1_loc(1) + g(it2)**2
        end do
        g = 0.
        do it2 = 1, N_loc
            ind = 6*(it2-1)
            ind2 = 108*(it2-1)
            do it3 = 1, 18
                g(ind+1) = g(ind+1) + kThat(ind2+it3)*du(ind+it3)
                g(ind+2) = g(ind+2) + kThat(ind2+18+it3)*du(ind+it3)
                g(ind+3) = g(ind+3) + kThat(ind2+36+it3)*du(ind+it3)
                g(ind+4) = g(ind+4) + kThat(ind2+54+it3)*du(ind+it3)
                g(ind+5) = g(ind+5) + kThat(ind2+72+it3)*du(ind+it3)
                g(ind+6) = g(ind+6) + kThat(ind2+90+it3)*du(ind+it3)
            end do
        end do
        do it2 = 1, 6*N_loc
            g(it2) = g(it2) - res(it2)
        end do
        do it2 = 1, 6*N_loc
            dn1_loc(2) = dn1_loc(2) + g(it2)**2
        end do
        call MPI_Allreduce(dn1_loc(1), dn1(1), 2, MPI_DOUBLE_PRECISION, MPI_SUM, MPI_COMM_WORLD, ierr)
        if (dn1(2) < tol_inv) then
            cnt_inv = cnt_inv+it
            call MPI_BARRIER(MPI_COMM_WORLD, ierr)
            t_inv_end = MPI_WTIME()
            t_inv_total = t_inv_total + t_inv_end-t_inv_start
            exit
        end if
        do it2 = 1, 6*N_loc
            d(it2+6) = -g(it2) + dn1(2)/dn1(1)*d(it2+6)
            dn2_loc(2) = dn2_loc(2) + d(it2+6)*g(it2)
        end do
        if (noProc /=1) then
            if (procID == 0) then
                call MPI_SEND(d(6*N_loc+1), 6, MPI_DOUBLE_PRECISION, procID+1, 1, &
                & MPI_COMM_WORLD, ierr)
                call MPI_RECV(d(6*N_loc+7), 6, MPI_DOUBLE_PRECISION, procID+1, 0, &
                & MPI_COMM_WORLD, status, ierr)
            else if (procID == noProc-1) then
                call MPI_SEND(d(7), 6, MPI_DOUBLE_PRECISION, procID-1, 0, &
                & MPI_COMM_WORLD, ierr) 
                call MPI_RECV(d(1), 6, MPI_DOUBLE_PRECISION, procID-1, 1, &
                & MPI_COMM_WORLD, status, ierr)
            else
                call MPI_SENDRECV(d(7), 6, MPI_DOUBLE_PRECISION, procID-1, 0, &
                & d(1), 6, MPI_DOUBLE_PRECISION, procID-1, 1, MPI_COMM_WORLD, status, ierr)
                call MPI_SENDRECV(d(6*N_loc+1), 6, MPI_DOUBLE_PRECISION, procID+1, 1, &
                & d(6*N_loc+7), 6, MPI_DOUBLE_PRECISION, procID+1, 0, MPI_COMM_WORLD, status, ierr)
            end if
        end if
        t = 0.
        do it2 = 1, N_loc
            ind = 6*(it2-1)
            ind2 = 108*(it2-1)
            do it3 = 1, 18
                t(ind+1) = t(ind+1) + kThat(ind2+it3)*d(ind+it3)
                t(ind+2) = t(ind+2) + kThat(ind2+18+it3)*d(ind+it3)
                t(ind+3) = t(ind+3) + kThat(ind2+36+it3)*d(ind+it3)
                t(ind+4) = t(ind+4) + kThat(ind2+54+it3)*d(ind+it3)
                t(ind+5) = t(ind+5) + kThat(ind2+72+it3)*d(ind+it3)
                t(ind+6) = t(ind+6) + kThat(ind2+90+it3)*d(ind+it3)
            end do
        end do
        do it2 = 1, 6*N_loc
            dn2_loc(1) = dn2_loc(1) + d(it2+6)*t(it2)
        end do
        call MPI_Allreduce(dn2_loc(1), dn2(1), 2, MPI_DOUBLE_PRECISION, MPI_SUM, MPI_COMM_WORLD, ierr)
        s = -dn2(2)/dn2(1)
        do it2 = 1, 6*N_loc
            du(it2+6) = du(it2+6) + s*d(it2+6)
        end do

        if (noProc /=1) then
            if (procID == 0) then
                call MPI_SEND(du(6*N_loc+1), 6, MPI_DOUBLE_PRECISION, procID+1, 1, &
                & MPI_COMM_WORLD, ierr)
                call MPI_RECV(du(6*N_loc+7), 6, MPI_DOUBLE_PRECISION, procID+1, 0, &
                & MPI_COMM_WORLD, status, ierr)
            else if (procID == noProc-1) then
                call MPI_SEND(du(7), 6, MPI_DOUBLE_PRECISION, procID-1, 0, &
                & MPI_COMM_WORLD, ierr) 
                call MPI_RECV(du(1), 6, MPI_DOUBLE_PRECISION, procID-1, 1, &
                & MPI_COMM_WORLD, status, ierr)
            else
                call MPI_SENDRECV(du(7), 6, MPI_DOUBLE_PRECISION, procID-1, 0, &
                & du(1), 6, MPI_DOUBLE_PRECISION, procID-1, 1, MPI_COMM_WORLD, status, ierr)
                call MPI_SENDRECV(du(6*N_loc+1), 6, MPI_DOUBLE_PRECISION, procID+1, 1, &
                & du(6*N_loc+7), 6, MPI_DOUBLE_PRECISION, procID+1, 0, MPI_COMM_WORLD, status, ierr)
            end if
        end if


    end do


    end subroutine calc_du


    !=============================================================================
    !=============================================================================
    subroutine NR_iterations(N_NR, tol_NR, N_loc, procID, noProc, BC, k, L, a1_loc, phat_loc, u_loc, &
    & N_inv, tol_inv, nt_it, cnt_NR, cnt_inv, t_NR_total, t_inv_total)

    use mpi
    implicit none

    ! Data dictionary:
    integer, intent(in) :: N_NR ! max number of itertations for matrix inversion
    real, intent(in) :: tol_NR !
    integer, intent(in) :: N_loc ! No. of unit cells per process
    integer, intent(in) :: procID, noProc
    integer, intent(in), dimension(0:2) :: BC
    real, intent(in), dimension(9) :: k
    real, intent(in), dimension(4) :: L
    real, intent(in), dimension(6*N_loc) :: a1_loc
    real, intent(in), dimension(6*N_loc) :: phat_loc
    real, intent(inout), dimension(6*(N_loc+2)) :: u_loc
    integer, intent(in) :: N_inv
    real, intent(in) :: tol_inv
    integer, intent(in) :: nt_it
    integer, intent(out) :: cnt_NR
    integer, intent(out) :: cnt_inv
    real, intent(inout) :: t_NR_total
    real, intent(inout) :: t_inv_total
    ! Data dictionary:
    integer :: ierr, status(MPI_STATUS_SIZE)
    real, dimension(6) :: fs
    real, dimension(6*N_loc) :: res
    real :: resSum_loc
    real :: resSum
    real, dimension(18*6*N_loc) :: kThat_loc
    real, dimension(6*(N_loc+2)) :: du_loc
    integer :: it, it2, it3, ind
    real :: t_NR_start, t_NR_end

    call MPI_BARRIER(MPI_COMM_WORLD, ierr)
    t_NR_start = MPI_WTIME()
    cnt_inv = 0
    do it = 1, N_NR
        resSum_loc= 0.
        do it2 = 1, N_loc
            if (it2 == 1 .and. procID == 0) then
                call calc_fs(BC(1), 0, 11, u_loc(6*it2+1), k, L, fs)
            else if (it2 == N_loc .and. procID == noProc-1) then
                call calc_fs(BC(2), -6, 5, u_loc(6*it2-5), k, L, fs)
            else
                call calc_fs(BC(0), -6, 11, u_loc(6*it2-5), k, L, fs)
            end if

            do it3 = 1, 6
                ind = 6*it2-6+it3
                res(ind) = phat_loc(ind) - fs(it3) - a1_loc(ind)*u_loc(ind+6)
!!                resSum_loc = resSum_loc + abs(res(ind))
!                resSum_loc = resSum_loc + res(ind)**2
            end do
        end do
!        call MPI_Allreduce(resSum_loc, resSum, 1, MPI_DOUBLE_PRECISION, MPI_SUM, MPI_COMM_WORLD, ierr)
!!        if (procID == 0 .and. it == 31) then
!!                write (*,*) res
!!                write (*,*) resSum
!!                write (*,*) du_loc
!!                stop
!!        end if
!        if (resSum < tol_NR) exit
        if (procID == 0 .and. it == N_NR) then
            write (*,*) "WARNING: Max number of NR iterations reached at ", nt_it, "th iteration."
            write (*,*) "resSum is ", resSum
        end if
        do it2 = 1, N_loc
            if (it2 == 1 .and. procID == 0) then
                call calc_kThat(BC(1), 0, 11, u_loc(6*it2+1), k, L, a1_loc(6*it2-5), kThat_loc(18*6*(it2-1)+1))
            else if (it2 == N_loc .and. procID == noProc-1) then
                call calc_kThat(BC(2), -6, 5, u_loc(6*it2-5), k, L, a1_loc(6*it2-5), kThat_loc(18*6*(it2-1)+1))
            else
                call calc_kThat(BC(0), -6, 11, u_loc(6*it2-5), k, L, a1_loc(6*it2-5), kThat_loc(18*6*(it2-1)+1))
            end if
        end do

        call calc_du(N_inv, tol_inv, N_loc, procID, noProc, kThat_loc, res, du_loc, nt_it, cnt_inv, t_inv_total)
        u_loc = u_loc + du_loc
        
        if (noProc /=1) then
            if (procID == 0) then
                call MPI_SEND(u_loc(6*N_loc+1), 6, MPI_DOUBLE_PRECISION, procID+1, 1, &
                & MPI_COMM_WORLD, ierr)
                call MPI_RECV(u_loc(6*N_loc+7), 6, MPI_DOUBLE_PRECISION, procID+1, 0, &
                & MPI_COMM_WORLD, status, ierr)
            else if (procID == noProc-1) then
                call MPI_SEND(u_loc(7), 6, MPI_DOUBLE_PRECISION, procID-1, 0, &
                & MPI_COMM_WORLD, ierr) 
                call MPI_RECV(u_loc(1), 6, MPI_DOUBLE_PRECISION, procID-1, 1, &
                & MPI_COMM_WORLD, status, ierr)
            else
                call MPI_SENDRECV(u_loc(7), 6, MPI_DOUBLE_PRECISION, procID-1, 0, &
                & u_loc(1), 6, MPI_DOUBLE_PRECISION, procID-1, 1, MPI_COMM_WORLD, status, ierr)
                call MPI_SENDRECV(u_loc(6*N_loc+1), 6, MPI_DOUBLE_PRECISION, procID+1, 1, &
                & u_loc(6*N_loc+7), 6, MPI_DOUBLE_PRECISION, procID+1, 0, MPI_COMM_WORLD, status, ierr)
            end if
        end if

        do it2 = 1, 6*N_loc
            resSum_loc = resSum_loc + abs(du_loc(it2)*res(it2))
        end do
        call MPI_Allreduce(resSum_loc, resSum, 1, MPI_DOUBLE_PRECISION, MPI_SUM, MPI_COMM_WORLD, ierr)
        if (resSum < tol_NR) then
            cnt_NR = it
            call MPI_BARRIER(MPI_COMM_WORLD, ierr)
            t_NR_end = MPI_WTIME()
            t_NR_total = t_NR_total + t_NR_end - t_NR_start
            exit
        end if

    end do

    end subroutine NR_iterations


end module sub_NB
