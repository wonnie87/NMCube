module sub_RK

contains
    subroutine calc_f(BC_flag, lowerBound, upperBound, m, b, p, k, L, x, f)

    implicit none

    !! Data dictionary
    integer, intent(in) :: BC_flag
    integer, intent(in) :: lowerBound
    integer, intent(in) :: upperBound
    real, intent(in), dimension(6) :: m
    real, intent(in), dimension(6) :: b
    real, intent(in), dimension(6) :: p
    real, intent(in), dimension(9) :: k
    real, intent(in), dimension(4) :: L
    real, intent(in), dimension(lowerBound:upperBound) :: x
    real, intent(out), dimension(12) :: f

    f = 0.
    if (BC_flag == 100) then
        f(1) = x(1)

        f(2) = ( p(1) -b(1)*x(1) - ((k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(2)*(L(4) - x(0) + x(4))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(L(4) - x(0) + x(8))*(Sqrt(L(3)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

        f(3) = x(3)
       
        f(4) = ( p(2) -b(2)*x(3) - ((k(1)*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2))*(-x(-10) + x(2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(2)*(L(2) - x(2) + x(6))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) + &
        &  (k(1)*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2))*(x(2) - x(14)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) -b(3)*x(5) - ((k(4)*(L(1) - x(-8) + x(4))*(-L(1) + Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2)))/&
        &   Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2) + &
        &  (k(7)*(L(1) - x(-4) + x(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2) + &
        &  (k(2)*(L(4) - x(0) + x(4))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) - &
        &  (k(4)*(L(1) - x(4) + x(16))*(-L(1) + Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2)))/&
        &   Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2) - &
        &  (k(8)*(L(1) - x(4) + x(20))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)))/&
        &   Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)) )/m(3)

        f(7) = x(7)
        
        f(8) = ( p(4) -b(4)*x(7) - ((k(4)*(-L(1) + Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2))*(-x(-6) + x(6)))/&
        &   Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2) + &
        &  (k(7)*(L(2) + L(3) - x(-2) + x(6))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2) + &
        &  (k(2)*(L(2) - x(2) + x(6))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) + &
        &  (k(4)*(-L(1) + Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2))*(x(6) - x(18)))/&
        &   Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2) + &
        &  (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2))*(L(2) + L(3) + x(6) - x(22)))/&
        &   Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)) )/m(4)

        f(9) = x(9)

        f(10) = ( p(5) -b(5)*x(9) - ((k(8)*(L(1) - x(-8) + x(8))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2)))/&
        &   Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2) + &
        &  (k(5)*(L(1) - x(-4) + x(8))*(-L(1) + Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2) + &
        &  (k(3)*(L(4) - x(0) + x(8))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) - &
        &  (k(7)*(L(1) - x(8) + x(16))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2)))/&
        &   Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2) - &
        &  (k(5)*(L(1) - x(8) + x(20))*(-L(1) + Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)))/&
        &   Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)) )/m(5)

        f(11) = x(11)

        f(12) = ( p(6) -b(6)*x(11) - (-((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &         Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2))*(L(2) + L(3) + x(-6) - x(10)))/&
        &     Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2)) + &
        &  (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) + &
        &  (k(5)*(-L(1) + Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2))*(-x(-2) + x(10)))/&
        &   Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2) - &
        &  (k(7)*(L(2) + L(3) - x(10) + x(18))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2)))/&
        &   Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2) + &
        &  (k(5)*(-L(1) + Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2))*(x(10) - x(22)))/&
        &   Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)) )/m(6)

    else if (BC_flag == 110) then
        f(1) = x(1)

        f(2) = ( p(1) - b(1)*x(1) - ((k(2)*(L(4) - x(0) + x(4))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(L(4) - x(0) + x(8))*(Sqrt(L(3)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - ((k(2)*(L(2) - x(2) + x(6))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) + &
        &  (k(1)*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2))*(x(2) - x(14)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) - b(3)*x(5) - ((k(2)*(L(4) - x(0) + x(4))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) - &
        &  (k(4)*(L(1) - x(4) + x(16))*(-L(1) + Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2)))/&
        &   Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2) - &
        &  (k(8)*(L(1) - x(4) + x(20))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)))/&
        &   Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)) )/m(3)

        f(7) = x(7)

        f(8) = ( p(4) - b(4)*x(7) - ((k(2)*(L(2) - x(2) + x(6))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) + &
        &  (k(4)*(-L(1) + Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2))*(x(6) - x(18)))/&
        &   Sqrt((L(1) - x(4) + x(16))**2 + (x(6) - x(18))**2) + &
        &  (k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2))*(L(2) + L(3) + x(6) - x(22)))/&
        &   Sqrt((L(1) - x(4) + x(20))**2 + (L(2) + L(3) + x(6) - x(22))**2)) )/m(4)

        f(9) = x(9)

        f(10) = ( p(5) - b(5)*x(9) - ((k(3)*(L(4) - x(0) + x(8))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) - &
        &  (k(7)*(L(1) - x(8) + x(16))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2)))/&
        &   Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2) - &
        &  (k(5)*(L(1) - x(8) + x(20))*(-L(1) + Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)))/&
        &   Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)) )/m(5)

        f(11) = x(11)

        f(12) = ( p(6) - b(6)*x(11) - ((k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) - &
        &  (k(7)*(L(2) + L(3) - x(10) + x(18))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2)))/&
        &   Sqrt((L(1) - x(8) + x(16))**2 + (L(2) + L(3) - x(10) + x(18))**2) + &
        &  (k(5)*(-L(1) + Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2))*(x(10) - x(22)))/&
        &   Sqrt((L(1) - x(8) + x(20))**2 + (x(10) - x(22))**2)) )/m(6)

    else if (BC_flag == 111) then
        f(1) = x(1)
        
        f(2) = ( p(1) - b(1)*x(1) - ((k(2)*(L(4) - x(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
        &  (k(3)*(L(4) - x(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) - &
        &  (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - ((k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2))*(L(2) - x(2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
        &  (k(3)*(L(3) + x(2))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) + &
        &  (k(1)*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2))*(x(2) - x(14)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(2)

    else if (BC_flag == 112) then
        f(1) = x(1)
        
        f(2) = ( p(1) - b(1)*x(1) - ((k(2)*(L(4) - x(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
        &  (k(3)*(L(4) - x(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2) - &
        &  (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2 + (x(2) - x(14))**2)) )/m(1)

    else if (BC_flag == 120) then
        f(1) = x(1)

        f(2) = ( p(1) - b(1)*x(1) - ((k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(2)*(L(4) - x(0) + x(4))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(L(4) - x(0) + x(8))*(Sqrt(L(3)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - ((k(1)*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2))*(-x(-10) + x(2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(2)*(L(2) - x(2) + x(6))*(Sqrt(L(2)**2 + L(4)**2) - &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(3)*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) - b(3)*x(5) - ((k(4)*(L(1) - x(-8) + x(4))*(-L(1) + Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2)))/&
        &   Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2) + &
        &  (k(7)*(L(1) - x(-4) + x(4))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2) + &
        &  (k(2)*(L(4) - x(0) + x(4))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)) )/m(3)

        f(7) = x(7)

        f(8) = ( p(4) - b(4)*x(7) - ((k(4)*(-L(1) + Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2))*(-x(-6) + x(6)))/&
        &   Sqrt((L(1) - x(-8) + x(4))**2 + (x(-6) - x(6))**2) + &
        &  (k(7)*(L(2) + L(3) - x(-2) + x(6))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(4))**2 + (L(2) + L(3) - x(-2) + x(6))**2) + &
        &  (k(2)*(L(2) - x(2) + x(6))*(-Sqrt(L(2)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2)))/&
        &   Sqrt((L(4) - x(0) + x(4))**2 + (L(2) - x(2) + x(6))**2) + &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)) )/m(4)

        f(9) = x(9)

        f(10) = ( p(5) - b(5)*x(9) - ((k(8)*(L(1) - x(-8) + x(8))*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &       Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2)))/&
        &   Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2) + &
        &  (k(5)*(L(1) - x(-4) + x(8))*(-L(1) + Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2)))/&
        &   Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2) + &
        &  (k(3)*(L(4) - x(0) + x(8))*(-Sqrt(L(3)**2 + L(4)**2) + &
        &       Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2)))/&
        &   Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(x(4) - x(8))*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)))/&
        &   Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2)) )/m(5)

        f(11) = x(11)

        f(12) = ( p(6) - b(6)*x(11) - (-((k(8)*(-Sqrt(L(1)**2 + (L(2) + L(3))**2) + &
        &         Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2))*(L(2) + L(3) + x(-6) - x(10)))/&
        &     Sqrt((L(1) - x(-8) + x(8))**2 + (L(2) + L(3) + x(-6) - x(10))**2)) + &
        &  (k(3)*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2))*&
        &     (L(3) + x(2) - x(10)))/Sqrt((L(4) - x(0) + x(8))**2 + (L(3) + x(2) - x(10))**2) - &
        &  (k(6)*(-L(2) - L(3) + Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2))*&
        &     (L(2) + L(3) + x(6) - x(10)))/Sqrt((x(4) - x(8))**2 + (L(2) + L(3) + x(6) - x(10))**2) + &
        &  (k(5)*(-L(1) + Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2))*(-x(-2) + x(10)))/&
        &   Sqrt((L(1) - x(-4) + x(8))**2 + (x(-2) - x(10))**2)) )/m(6)

    else if (BC_flag == 121) then
        f(1) = x(1)
        
        f(2) = ( p(1) - b(1)*x(1) - ((k(2)*(L(4) - x(0))*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
        &  (k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(3)*(L(4) - x(0))*(Sqrt(L(3)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - ((k(2)*(Sqrt(L(2)**2 + L(4)**2) - Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2))*(L(2) - x(2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(2) - x(2))**2) + &
        &  (k(1)*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2))*(-x(-10) + x(2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2 + (x(-10) - x(2))**2) + &
        &  (k(3)*(L(3) + x(2))*(-Sqrt(L(3)**2 + L(4)**2) + Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)))/&
        &   Sqrt((L(4) - x(0))**2 + (L(3) + x(2))**2)) )/m(2)

    else if (BC_flag == 800 .or. BC_flag == 810 .or. BC_flag == 820) then
        f(1) = x(1)

        f(2) = ( p(1) -b(1)*x(1) - ((-2*k(2)*(-Sqrt(L(2)**2 + L(4)**2) + Sqrt(L(2)**2 + (L(4) - x(0))**2))*(L(4) - x(0)))/&
        &   Sqrt(L(2)**2 + (L(4) - x(0))**2) + (k(1)*(L(1) - x(-12) + x(0))*(-L(1) + Sqrt((L(1) - x(-12) + x(0))**2)))/&
        &   Sqrt((L(1) - x(-12) + x(0))**2) - (k(1)*(L(1) - x(0) + x(12))*(-L(1) + Sqrt((L(1) - x(0) + x(12))**2)))/&
        &   Sqrt((L(1) - x(0) + x(12))**2)) )/m(1)

    else if (BC_flag == 811) then
        f(1) = x(1)

        f(2) = ( p(1) -b(1)*x(1) - (-((k(1)*(L(1) + x(12))*(-L(1) + Sqrt((L(1) + x(12))**2)))/Sqrt((L(1) + x(12))**2))) )/m(1)

    else if (BC_flag == 821) then
        f(1) = x(1)

        f(2) = ( p(1) -b(1)*x(1) -((k(1)*(-L(1) + Sqrt((L(1) - x(-12))**2))*(L(1) - x(-12)))/Sqrt((L(1) - x(-12))**2)) )/m(1)

    end if

    end subroutine calc_f

    subroutine calc_fLin(BC_flag, lowerBound, upperBound, m, b, p, k, L, x, f)

    implicit none

    !! Data dictionary
    integer, intent(in) :: BC_flag
    integer, intent(in) :: lowerBound
    integer, intent(in) :: upperBound
    real, intent(in), dimension(6) :: m
    real, intent(in), dimension(6) :: b
    real, intent(in), dimension(6) :: p
    real, intent(in), dimension(9) :: k
    real, intent(in), dimension(4) :: L
    real, intent(in), dimension(lowerBound:upperBound) :: x
    real, intent(out), dimension(12) :: f

    f = 0.
    if (BC_flag == 100) then
        f(1) = x(1)


        f(2) = ( p(1) -b(1)*x(1) - (-(k(1)*x(-12)) + (2*k(1) + L(4)**2*(k(2)/(L(2)**2 + L(4)**2) + k(3)/(L(3)**2 + L(4)**2)))*&
        &   x(0) + (k(2)*L(2)*L(4)*x(2))/(L(2)**2 + L(4)**2) - &
        &  (k(3)*L(3)*L(4)*x(2))/(L(3)**2 + L(4)**2) - (k(2)*L(4)**2*x(4))/(L(2)**2 + L(4)**2) - &
        &  (k(2)*L(2)*L(4)*x(6))/(L(2)**2 + L(4)**2) - (k(3)*L(4)**2*x(8))/(L(3)**2 + L(4)**2) + &
        &  (k(3)*L(3)*L(4)*x(10))/(L(3)**2 + L(4)**2) - k(1)*x(12)) )/m(1)

        f(3) = x(3)
       
        f(4) = ( p(2) -b(2)*x(3) - (-(k(1)*x(-10)) + (k(1)*Sqrt(L(1)**2)*x(-10))/L(1) + &
        &  ((k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2) - (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(0) + &
        &  2*k(1)*x(2) - (2*k(1)*Sqrt(L(1)**2)*x(2))/L(1) + (k(2)*L(2)**2*x(2))/(L(2)**2 + L(4)**2) + &
        &  (k(3)*L(3)**2*x(2))/(L(3)**2 + L(4)**2) - (k(2)*L(2)*L(4)*x(4))/(L(2)**2 + L(4)**2) - &
        &  (k(2)*L(2)**2*x(6))/(L(2)**2 + L(4)**2) + (k(3)*L(3)*L(4)*x(8))/(L(3)**2 + L(4)**2) - &
        &  (k(3)*L(3)**2*x(10))/(L(3)**2 + L(4)**2) - k(1)*x(14) + (k(1)*Sqrt(L(1)**2)*x(14))/L(1)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) -b(3)*x(5) - (-(k(4)*x(-8)) - (k(7)*L(1)**2*x(-4))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(7)*L(1)*(L(2) + L(3))*x(-2))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(2)*L(4)**2*x(0))/(L(2)**2 + L(4)**2) - (k(2)*L(2)*L(4)*x(2))/(L(2)**2 + L(4)**2) + &
        &  (2*k(4) + (k(7)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(8)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(6)*(L(2) + L(3) - Sqrt((L(2) + L(3))**2)))/(L(2) + L(3)) + &
        &     (k(2)*L(4)**2)/(L(2)**2 + L(4)**2))*x(4) + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2))*x(6) - &
        &  (k(6)*(-L(2) - L(3) + Sqrt((L(2) + L(3))**2))*x(8))/Sqrt((L(2) + L(3))**2) - k(4)*x(16) - &
        &  (k(8)*L(1)**2*x(20))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(8)*L(1)*(L(2) + L(3))*x(22))/(L(1)**2 + (L(2) + L(3))**2)) )/m(3)

        f(7) = x(7)
        
        f(8) = ( p(4) -b(4)*x(7) - ((k(6)*(L(2) + L(3))*(-L(2) - L(3) + Sqrt((L(2) + L(3))**2)))/Sqrt((L(2) + L(3))**2) + &
        &  (k(4)*(-L(1) + Sqrt(L(1)**2))*x(-6))/L(1) - &
        &  (k(7)*L(1)*(L(2) + L(3))*x(-4))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(7)*(L(2) + L(3))**2*x(-2))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(2)*L(2)*L(4)*x(0))/(L(2)**2 + L(4)**2) - (k(2)*L(2)**2*x(2))/(L(2)**2 + L(4)**2) + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2))*x(4) + &
        &  (k(6) + k(4)*(2 - (2*Sqrt(L(1)**2))/L(1)) + &
        &     (k(7)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(8)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + (k(2)*L(2)**2)/(L(2)**2 + L(4)**2))&
        &    *x(6) - k(6)*x(10) + (k(4)*(-L(1) + Sqrt(L(1)**2))*x(18))/L(1) + &
        &  (k(8)*L(1)*(L(2) + L(3))*x(20))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(8)*(L(2) + L(3))**2*x(22))/(L(1)**2 + (L(2) + L(3))**2)) )/m(4)

        f(9) = x(9)

        f(10) = ( p(5) -b(5)*x(9) - (-((k(8)*L(1)**2*x(-8))/(L(1)**2 + (L(2) + L(3))**2)) + &
        &  (k(8)*L(1)*(L(2) + L(3))*x(-6))/(L(1)**2 + (L(2) + L(3))**2) - k(5)*x(-4) - &
        &  (k(3)*L(4)**2*x(0))/(L(3)**2 + L(4)**2) + (k(3)*L(3)*L(4)*x(2))/(L(3)**2 + L(4)**2) - &
        &  (k(6)*(-L(2) - L(3) + Sqrt((L(2) + L(3))**2))*x(4))/Sqrt((L(2) + L(3))**2) + &
        &  (2*k(5) + (k(7)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(8)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(6)*(L(2) + L(3) - Sqrt((L(2) + L(3))**2)))/(L(2) + L(3)) + &
        &     (k(3)*L(4)**2)/(L(3)**2 + L(4)**2))*x(8) + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(10) - &
        &  (k(7)*L(1)**2*x(16))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(7)*L(1)*(L(2) + L(3))*x(18))/(L(1)**2 + (L(2) + L(3))**2) - k(5)*x(20)) )/m(5)

        f(11) = x(11)

        f(12) = ( p(6) -b(6)*x(11) - (-((k(6)*(L(2) + L(3))*(-L(2) - L(3) + Sqrt((L(2) + L(3))**2)))/Sqrt((L(2) + L(3))**2)) + &
        &  (k(8)*L(1)*(L(2) + L(3))*x(-8))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(8)*(L(2) + L(3))**2*x(-6))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(5)*(-L(1) + Sqrt(L(1)**2))*x(-2))/L(1) + (k(3)*L(3)*L(4)*x(0))/(L(3)**2 + L(4)**2) - &
        &  (k(3)*L(3)**2*x(2))/(L(3)**2 + L(4)**2) - k(6)*x(6) + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(8) + &
        &  (k(6) + k(5)*(2 - (2*Sqrt(L(1)**2))/L(1)) + &
        &     (k(7)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(8)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + (k(3)*L(3)**2)/(L(3)**2 + L(4)**2))&
        &    *x(10) - (k(7)*L(1)*(L(2) + L(3))*x(16))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(7)*(L(2) + L(3))**2*x(18))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(5)*(-L(1) + Sqrt(L(1)**2))*x(22))/L(1)) )/m(6)

    else if (BC_flag == 111) then
        f(1) = x(1)
        
        f(2) = ( p(1) - b(1)*x(1) - ((L(4)*(k(2)*(L(3)**2 + L(4)**2)*(L(4)*x(0) + L(2)*x(2)) + &
        &       k(3)*(L(2)**2 + L(4)**2)*(L(4)*x(0) - L(3)*x(2))))/&
        &   ((L(2)**2 + L(4)**2)*(L(3)**2 + L(4)**2)) + k(1)*(x(0) - x(12))) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - ((k(2)*L(2)*(L(3)**2 + L(4)**2)*(L(4)*x(0) + L(2)*x(2)) + &
        &    k(3)*L(3)*(L(2)**2 + L(4)**2)*(-(L(4)*x(0)) + L(3)*x(2)))/&
        &  ((L(2)**2 + L(4)**2)*(L(3)**2 + L(4)**2))) )/m(2)

    else if (BC_flag == 120) then
        f(1) = x(1)

        f(2) = ( p(1) - b(1)*x(1) - (-(k(1)*x(-12)) + (k(1) + L(4)**2*(k(2)/(L(2)**2 + L(4)**2) + k(3)/(L(3)**2 + L(4)**2)))*&
        &   x(0) + L(4)*((k(2)*L(2)*x(2))/(L(2)**2 + L(4)**2) - (k(3)*L(3)*x(2))/(L(3)**2 + L(4)**2) - &
        &     (k(2)*L(4)*x(4))/(L(2)**2 + L(4)**2) - (k(2)*L(2)*x(6))/(L(2)**2 + L(4)**2) - &
        &     (k(3)*L(4)*x(8))/(L(3)**2 + L(4)**2) + (k(3)*L(3)*x(10))/(L(3)**2 + L(4)**2))) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - (((k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2) - (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(0) + &
        &  (k(2)*L(2)**2*x(2))/(L(2)**2 + L(4)**2) + (k(3)*L(3)**2*x(2))/(L(3)**2 + L(4)**2) - &
        &  (k(2)*L(2)*L(4)*x(4))/(L(2)**2 + L(4)**2) - (k(2)*L(2)**2*x(6))/(L(2)**2 + L(4)**2) + &
        &  (k(3)*L(3)*L(4)*x(8))/(L(3)**2 + L(4)**2) - (k(3)*L(3)**2*x(10))/(L(3)**2 + L(4)**2)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) - b(3)*x(5) - (-(k(4)*x(-8)) - (k(7)*L(1)**2*x(-4))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(7)*L(1)*(L(2) + L(3))*x(-2))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(2)*L(4)**2*x(0))/(L(2)**2 + L(4)**2) - (k(2)*L(2)*L(4)*x(2))/(L(2)**2 + L(4)**2) + &
        &  (k(4) + (k(7)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + (k(2)*L(4)**2)/(L(2)**2 + L(4)**2))*&
        &   x(4) + ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2))*x(6)) )/m(3)

        f(7) = x(7)

        f(8) = ( p(4) - b(4)*x(7) - (-((k(7)*L(1)*(L(2) + L(3))*x(-4))/(L(1)**2 + (L(2) + L(3))**2)) - &
        &  (k(7)*(L(2) + L(3))**2*x(-2))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(2)*L(2)*L(4)*x(0))/(L(2)**2 + L(4)**2) - (k(2)*L(2)**2*x(2))/(L(2)**2 + L(4)**2) + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2))*x(4) + &
        &  (k(6) + (k(7)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)**2)/(L(2)**2 + L(4)**2))*x(6) - k(6)*x(10)) )/m(4)

        f(9) = x(9)

        f(10) = ( p(5) - b(5)*x(9) - (-((k(8)*L(1)**2*x(-8))/(L(1)**2 + (L(2) + L(3))**2)) + &
        &  (k(8)*L(1)*(L(2) + L(3))*x(-6))/(L(1)**2 + (L(2) + L(3))**2) - k(5)*x(-4) - &
        &  (k(3)*L(4)**2*x(0))/(L(3)**2 + L(4)**2) + (k(3)*L(3)*L(4)*x(2))/(L(3)**2 + L(4)**2) + &
        &  (k(5) + (k(8)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + (k(3)*L(4)**2)/(L(3)**2 + L(4)**2))*&
        &   x(8) + (-((k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2)) - &
        &     (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(10)) )/m(5)

        f(11) = x(11)

        f(12) = ( p(6) - b(6)*x(11) - ((k(8)*L(1)*(L(2) + L(3))*x(-8))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(8)*(L(2) + L(3))**2*x(-6))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(3)*L(3)*L(4)*x(0))/(L(3)**2 + L(4)**2) - (k(3)*L(3)**2*x(2))/(L(3)**2 + L(4)**2) - &
        &  k(6)*x(6) + (-((k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2)) - &
        &     (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(8) + &
        &  (k(6) + (k(8)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(3)*L(3)**2)/(L(3)**2 + L(4)**2))*x(10)) )/m(6)

    end if

    end subroutine calc_fLin

    subroutine calc_fQuad(BC_flag, lowerBound, upperBound, m, b, p, k, L, x, f)

    implicit none

    !! Data dictionary
    integer, intent(in) :: BC_flag
    integer, intent(in) :: lowerBound
    integer, intent(in) :: upperBound
    real, intent(in), dimension(6) :: m
    real, intent(in), dimension(6) :: b
    real, intent(in), dimension(6) :: p
    real, intent(in), dimension(9) :: k
    real, intent(in), dimension(4) :: L
    real, intent(in), dimension(lowerBound:upperBound) :: x
    real, intent(out), dimension(12) :: f

    f = 0.
    if (BC_flag == 100) then
        f(1) = x(1)


        f(2) = ( p(1) -b(1)*x(1) - (-(k(1)*x(-12)) + (k(1)*x(-10)**2)/(2.*L(1)) + &
        &  (2*k(1) + L(4)**2*(k(2)/(L(2)**2 + L(4)**2) + k(3)/(L(3)**2 + L(4)**2)))*x(0) - &
        &  (3*L(4)*(k(3)*L(3)**2*(L(2)**2 + L(4)**2)**2 + k(2)*L(2)**2*(L(3)**2 + L(4)**2)**2)*&
        &     x(0)**2)/(2.*(L(2)**2 + L(4)**2)**2*(L(3)**2 + L(4)**2)**2) + &
        &  (k(2)*L(2)*L(4)*x(2))/(L(2)**2 + L(4)**2) - (k(3)*L(3)*L(4)*x(2))/(L(3)**2 + L(4)**2) - &
        &  (k(1)*x(-10)*x(2))/L(1) + ((k(3)*L(3)*(L(3)**2 - 2*L(4)**2))/(L(3)**2 + L(4)**2)**2 - &
        &     (k(2)*(L(2)**3 - 2*L(2)*L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(0)*x(2) + &
        &  (L(4)*((k(2)*(2*L(2)**2 - L(4)**2))/(L(2)**2 + L(4)**2)**2 + &
        &       (k(3)*(2*L(3)**2 - L(4)**2))/(L(3)**2 + L(4)**2)**2)*x(2)**2)/2. - &
        &  (k(2)*L(4)**2*x(4))/(L(2)**2 + L(4)**2) + &
        &  (3*k(2)*L(2)**2*L(4)*x(0)*x(4))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(2)*x(4))/(L(2)**2 + L(4)**2)**2 - &
        &  (3*k(2)*L(2)**2*L(4)*x(4)**2)/(2.*(L(2)**2 + L(4)**2)**2) - &
        &  (k(2)*L(2)*L(4)*x(6))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)*x(6))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(2)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(4)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(6)**2)/(2.*(L(2)**2 + L(4)**2)**2) - &
        &  (k(3)*L(4)**2*x(8))/(L(3)**2 + L(4)**2) + &
        &  (3*k(3)*L(3)**2*L(4)*x(0)*x(8))/(L(3)**2 + L(4)**2)**2 - &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(2)*x(8))/(L(3)**2 + L(4)**2)**2 - &
        &  (3*k(3)*L(3)**2*L(4)*x(8)**2)/(2.*(L(3)**2 + L(4)**2)**2) + &
        &  (k(3)*L(3)*L(4)*x(10))/(L(3)**2 + L(4)**2) - &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)*x(10))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(2)*x(10))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(8)*x(10))/(L(3)**2 + L(4)**2)**2 - &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(10)**2)/(2.*(L(3)**2 + L(4)**2)**2) - k(1)*x(12) + &
        &  (k(1)*x(2)*x(14))/L(1) - (k(1)*x(14)**2)/(2.*L(1))) )/m(1)

        f(3) = x(3)
       
        f(4) = ( p(2) -b(2)*x(3) - ((k(1)*x(-12)*x(-10))/L(1) + ((k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2) - &
        &     (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(0) - (k(1)*x(-10)*x(0))/L(1) + &
        &  (((k(3)*L(3)*(L(3)**2 - 2*L(4)**2))/(L(3)**2 + L(4)**2)**2 - &
        &       (k(2)*(L(2)**3 - 2*L(2)*L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(0)**2)/2. + &
        &  (k(2)*L(2)**2*x(2))/(L(2)**2 + L(4)**2) + (k(3)*L(3)**2*x(2))/(L(3)**2 + L(4)**2) - &
        &  (k(1)*x(-12)*x(2))/L(1) + L(4)*&
        &   ((k(2)*(2*L(2)**2 - L(4)**2))/(L(2)**2 + L(4)**2)**2 + &
        &     (k(3)*(2*L(3)**2 - L(4)**2))/(L(3)**2 + L(4)**2)**2)*x(0)*x(2) + &
        &  (3*L(4)**2*(k(3)*L(3)*(L(2)**2 + L(4)**2)**2 - k(2)*L(2)*(L(3)**2 + L(4)**2)**2)*&
        &     x(2)**2)/(2.*(L(2)**2 + L(4)**2)**2*(L(3)**2 + L(4)**2)**2) - &
        &  (k(2)*L(2)*L(4)*x(4))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)*x(4))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(2)*x(4))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(4)**2)/(2.*(L(2)**2 + L(4)**2)**2) - &
        &  (k(2)*L(2)**2*x(6))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(0)*x(6))/(L(2)**2 + L(4)**2)**2 + &
        &  (3*k(2)*L(2)*L(4)**2*x(2)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(4)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (3*k(2)*L(2)*L(4)**2*x(6)**2)/(2.*(L(2)**2 + L(4)**2)**2) + &
        &  (k(3)*L(3)*L(4)*x(8))/(L(3)**2 + L(4)**2) - &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)*x(8))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(2)*x(8))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(8)**2)/(2.*(L(3)**2 + L(4)**2)**2) - &
        &  (k(3)*L(3)**2*x(10))/(L(3)**2 + L(4)**2) + &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(0)*x(10))/(L(3)**2 + L(4)**2)**2 - &
        &  (3*k(3)*L(3)*L(4)**2*x(2)*x(10))/(L(3)**2 + L(4)**2)**2 - &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(8)*x(10))/(L(3)**2 + L(4)**2)**2 + &
        &  (3*k(3)*L(3)*L(4)**2*x(10)**2)/(2.*(L(3)**2 + L(4)**2)**2) + (k(1)*x(2)*x(12))/L(1) + &
        &  (k(1)*x(0)*x(14))/L(1) - (k(1)*x(12)*x(14))/L(1)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) -b(3)*x(5) - (-(k(4)*x(-8)) + (k(4)*x(-6)**2)/(2.*L(1)) - &
        &  (k(7)*L(1)**2*x(-4))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (3*k(7)*L(1)*(L(2) + L(3))**2*x(-4)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(7)*L(1)*(L(2) + L(3))*x(-2))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-4)*x(-2))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-2)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - (k(2)*L(4)**2*x(0))/(L(2)**2 + L(4)**2) + &
        &  (3*k(2)*L(2)**2*L(4)*x(0)**2)/(2.*(L(2)**2 + L(4)**2)**2) - &
        &  (k(2)*L(2)*L(4)*x(2))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)*x(2))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(2)**2)/(2.*(L(2)**2 + L(4)**2)**2) + &
        &  (2*k(4) + (k(7)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(8)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + (k(2)*L(4)**2)/(L(2)**2 + L(4)**2))*&
        &   x(4) - (3*k(7)*L(1)*(L(2) + L(3))**2*x(-4)*x(4))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-2)*x(4))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(2)*L(2)**2*L(4)*x(0)*x(4))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(2)*x(4))/(L(2)**2 + L(4)**2)**2 + &
        &  (3*((k(7)*L(1)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &       (k(8)*L(1)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &       (k(2)*L(2)**2*L(4))/(L(2)**2 + L(4)**2)**2)*x(4)**2)/2. + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2))*x(6) - (k(4)*x(-6)*x(6))/L(1) - &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-4)*x(6))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-2)*x(6))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(2)*x(6))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(6)/(L(2) + L(3)) - (3*k(7)*L(1)**2*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &     (3*k(8)*L(1)**2*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &     (k(7)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(8)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (3*k(2)*L(2)*L(4)**2)/(L(2)**2 + L(4)**2)**2 + (k(2)*L(2))/(L(2)**2 + L(4)**2))*x(4)*&
        &   x(6) + (((k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &       (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &       (k(2)*L(4)*(-2*L(2)**2 + L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(6)**2)/2. - &
        &  (k(6)*x(6)*x(8))/(L(2) + L(3)) - (k(6)*x(4)*x(10))/(L(2) + L(3)) + &
        &  (k(6)*x(8)*x(10))/(L(2) + L(3)) - k(4)*x(16) + (k(4)*x(6)*x(18))/L(1) - &
        &  (k(4)*x(18)**2)/(2.*L(1)) - (k(8)*L(1)**2*x(20))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (3*k(8)*L(1)*(L(2) + L(3))**2*x(4)*x(20))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(6)*x(20))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(8)*L(1)*(L(2) + L(3))**2*x(20)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) + &
        &  (k(8)*L(1)*(L(2) + L(3))*x(22))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(4)*x(22))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(6)*x(22))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(20)*x(22))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(22)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2)) )/m(3)

        f(7) = x(7)
        
        f(8) = ( p(4) -b(4)*x(7) - ((k(4)*x(-8)*x(-6))/L(1) - (k(7)*L(1)*(L(2) + L(3))*x(-4))/&
        &   (L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-4)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(7)*(L(2) + L(3))**2*x(-2))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-4)*x(-2))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (3*k(7)*L(1)**2*(L(2) + L(3))*x(-2)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(2)*L(2)*L(4)*x(0))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)**2)/(2.*(L(2)**2 + L(4)**2)**2) - &
        &  (k(2)*L(2)**2*x(2))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(0)*x(2))/(L(2)**2 + L(4)**2)**2 + &
        &  (3*k(2)*L(2)*L(4)**2*x(2)**2)/(2.*(L(2)**2 + L(4)**2)**2) + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2))*x(4) - (k(4)*x(-6)*x(4))/L(1) - &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-4)*x(4))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-2)*x(4))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)*x(4))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(2)*x(4))/(L(2)**2 + L(4)**2)**2 + &
        &  ((k(6)/(L(2) + L(3)) - (3*k(7)*L(1)**2*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &       (3*k(8)*L(1)**2*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &       (k(7)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &       (k(8)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &       (3*k(2)*L(2)*L(4)**2)/(L(2)**2 + L(4)**2)**2 + (k(2)*L(2))/(L(2)**2 + L(4)**2))*&
        &     x(4)**2)/2. + (k(6) + (k(7)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(8)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)**2)/(L(2)**2 + L(4)**2))*x(6) - (k(4)*x(-8)*x(6))/L(1) - &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-4)*x(6))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(7)*L(1)**2*(L(2) + L(3))*x(-2)*x(6))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(0)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (3*k(2)*L(2)*L(4)**2*x(2)*x(6))/(L(2)**2 + L(4)**2)**2 + &
        &  ((k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &     (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &     (k(2)*L(4)*(-2*L(2)**2 + L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(4)*x(6) + &
        &  (3*(k(2)*L(2)*(L(1)**2 + (L(2) + L(3))**2)**2*L(4)**2 + &
        &       k(7)*L(1)**2*(L(2) + L(3))*(L(2)**2 + L(4)**2)**2 + &
        &       k(8)*L(1)**2*(L(2) + L(3))*(L(2)**2 + L(4)**2)**2)*x(6)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2*(L(2)**2 + L(4)**2)**2) - &
        &  (k(6)*x(4)*x(8))/(L(2) + L(3)) + (k(6)*x(8)**2)/(2.*(L(2) + L(3))) - k(6)*x(10) + &
        &  (k(4)*x(6)*x(16))/L(1) + (k(4)*x(4)*x(18))/L(1) - (k(4)*x(16)*x(18))/L(1) + &
        &  (k(8)*L(1)*(L(2) + L(3))*x(20))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(4)*x(20))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(6)*x(20))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(20)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(8)*(L(2) + L(3))**2*x(22))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(4)*x(22))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(8)*L(1)**2*(L(2) + L(3))*x(6)*x(22))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(20)*x(22))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (3*k(8)*L(1)**2*(L(2) + L(3))*x(22)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2)) )/m(4)

        f(9) = x(9)

        f(10) = ( p(5) -b(5)*x(9) - (-((k(8)*L(1)**2*x(-8))/(L(1)**2 + (L(2) + L(3))**2)) + &
        &  (3*k(8)*L(1)*(L(2) + L(3))**2*x(-8)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) + &
        &  (k(8)*L(1)*(L(2) + L(3))*x(-6))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-8)*x(-6))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-6)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - k(5)*x(-4) + (k(5)*x(-2)**2)/(2.*L(1)) - &
        &  (k(3)*L(4)**2*x(0))/(L(3)**2 + L(4)**2) + &
        &  (3*k(3)*L(3)**2*L(4)*x(0)**2)/(2.*(L(3)**2 + L(4)**2)**2) + &
        &  (k(3)*L(3)*L(4)*x(2))/(L(3)**2 + L(4)**2) - &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)*x(2))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(2)**2)/(2.*(L(3)**2 + L(4)**2)**2) - &
        &  (k(6)*x(4)*x(6))/(L(2) + L(3)) + &
        &  (2*k(5) + (k(7)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(8)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + (k(3)*L(4)**2)/(L(3)**2 + L(4)**2))*&
        &   x(8) - (3*k(8)*L(1)*(L(2) + L(3))**2*x(-8)*x(8))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-6)*x(8))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(3)*L(3)**2*L(4)*x(0)*x(8))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(2)*x(8))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(6)*x(6)*x(8))/(L(2) + L(3)) + &
        &  (3*(-((k(7)*L(1)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2)**2) + &
        &       (k(8)*L(1)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &       (k(3)*L(3)**2*L(4))/(L(3)**2 + L(4)**2)**2)*x(8)**2)/2. + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(10) + &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-8)*x(10))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-6)*x(10))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - (k(5)*x(-2)*x(10))/L(1) + &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)*x(10))/(L(3)**2 + L(4)**2)**2 - &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(2)*x(10))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(6)*x(4)*x(10))/(L(2) + L(3)) + &
        &  (-(k(6)/(L(2) + L(3))) + (3*k(7)*L(1)**2*(L(2) + L(3)))/&
        &      (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &     (3*k(8)*L(1)**2*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &     (k(7)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(8)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (3*k(3)*L(3)*L(4)**2)/(L(3)**2 + L(4)**2)**2 - (k(3)*L(3))/(L(3)**2 + L(4)**2))*x(8)*&
        &   x(10) + ((-((k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/&
        &          (L(1)**2 + (L(2) + L(3))**2)**2) + &
        &       (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &       (k(3)*L(4)*(-2*L(3)**2 + L(4)**2))/(L(3)**2 + L(4)**2)**2)*x(10)**2)/2. - &
        &  (k(7)*L(1)**2*x(16))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (3*k(7)*L(1)*(L(2) + L(3))**2*x(8)*x(16))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(10)*x(16))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(7)*L(1)*(L(2) + L(3))**2*x(16)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(7)*L(1)*(L(2) + L(3))*x(18))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(8)*x(18))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(10)*x(18))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(16)*x(18))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(18)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - k(5)*x(20) + (k(5)*x(10)*x(22))/L(1) - &
        &  (k(5)*x(22)**2)/(2.*L(1))) )/m(5)

        f(11) = x(11)

        f(12) = ( p(6) -b(6)*x(11) - ((k(8)*L(1)*(L(2) + L(3))*x(-8))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-8)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(8)*(L(2) + L(3))**2*x(-6))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-8)*x(-6))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(8)*L(1)**2*(L(2) + L(3))*x(-6)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) + &
        &  (k(5)*x(-4)*x(-2))/L(1) + (k(3)*L(3)*L(4)*x(0))/(L(3)**2 + L(4)**2) - &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)**2)/(2.*(L(3)**2 + L(4)**2)**2) - &
        &  (k(3)*L(3)**2*x(2))/(L(3)**2 + L(4)**2) + &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(0)*x(2))/(L(3)**2 + L(4)**2)**2 - &
        &  (3*k(3)*L(3)*L(4)**2*x(2)**2)/(2.*(L(3)**2 + L(4)**2)**2) - &
        &  (k(6)*x(4)**2)/(2.*(L(2) + L(3))) - k(6)*x(6) + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &     (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(8) + &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-8)*x(8))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-6)*x(8))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(5)*x(-2)*x(8))/L(1) + (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)*x(8))/&
        &   (L(3)**2 + L(4)**2)**2 - (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(2)*x(8))/&
        &   (L(3)**2 + L(4)**2)**2 + (k(6)*x(4)*x(8))/(L(2) + L(3)) + &
        &  ((-(k(6)/(L(2) + L(3))) + (3*k(7)*L(1)**2*(L(2) + L(3)))/&
        &        (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &       (3*k(8)*L(1)**2*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &       (k(7)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) - &
        &       (k(8)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &       (3*k(3)*L(3)*L(4)**2)/(L(3)**2 + L(4)**2)**2 - (k(3)*L(3))/(L(3)**2 + L(4)**2))*&
        &     x(8)**2)/2. + (k(6) + (k(7)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(8)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(3)*L(3)**2)/(L(3)**2 + L(4)**2))*x(10) - &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-8)*x(10))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (3*k(8)*L(1)**2*(L(2) + L(3))*x(-6)*x(10))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(5)*x(-4)*x(10))/L(1) - (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(0)*x(10))/&
        &   (L(3)**2 + L(4)**2)**2 + (3*k(3)*L(3)*L(4)**2*x(2)*x(10))/(L(3)**2 + L(4)**2)**2 + &
        &  (-((k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/(L(1)**2 + (L(2) + L(3))**2)**2) + &
        &     (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &     (k(3)*L(4)*(-2*L(3)**2 + L(4)**2))/(L(3)**2 + L(4)**2)**2)*x(8)*x(10) - &
        &  (3*(k(3)*L(3)*(L(1)**2 + (L(2) + L(3))**2)**2*L(4)**2 + &
        &       k(7)*L(1)**2*(L(2) + L(3))*(L(3)**2 + L(4)**2)**2 + &
        &       k(8)*L(1)**2*(L(2) + L(3))*(L(3)**2 + L(4)**2)**2)*x(10)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2*(L(3)**2 + L(4)**2)**2) - &
        &  (k(7)*L(1)*(L(2) + L(3))*x(16))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(8)*x(16))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(10)*x(16))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(16)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(7)*(L(2) + L(3))**2*x(18))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(8)*x(18))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (3*k(7)*L(1)**2*(L(2) + L(3))*x(10)*x(18))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(16)*x(18))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(7)*L(1)**2*(L(2) + L(3))*x(18)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) + &
        &  (k(5)*x(10)*x(20))/L(1) + (k(5)*x(8)*x(22))/L(1) - (k(5)*x(20)*x(22))/L(1)) )/m(6)

    else if (BC_flag == 111) then
        f(1) = x(1)
        
        f(2) = ( p(1) - b(1)*x(1) - ((k(1) + L(4)**2*(k(2)/(L(2)**2 + L(4)**2) + k(3)/(L(3)**2 + L(4)**2)))*x(0) - &
        &  (3*L(4)*(k(3)*L(3)**2*(L(2)**2 + L(4)**2)**2 + k(2)*L(2)**2*(L(3)**2 + L(4)**2)**2)*&
        &     x(0)**2)/(2.*(L(2)**2 + L(4)**2)**2*(L(3)**2 + L(4)**2)**2) + &
        &  L(4)*((k(2)*L(2))/(L(2)**2 + L(4)**2) - (k(3)*L(3))/(L(3)**2 + L(4)**2))*x(2) + &
        &  ((k(3)*L(3)*(L(3)**2 - 2*L(4)**2))/(L(3)**2 + L(4)**2)**2 - &
        &     (k(2)*(L(2)**3 - 2*L(2)*L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(0)*x(2) + &
        &  ((-(k(1)/L(1)) - (k(3)*L(4)*(-2*L(3)**2 + L(4)**2))/(L(3)**2 + L(4)**2)**2 + &
        &       (k(2)*(2*L(2)**2*L(4) - L(4)**3))/(L(2)**2 + L(4)**2)**2)*x(2)**2)/2. - &
        &  k(1)*x(12) + (k(1)*x(2)*x(14))/L(1) - (k(1)*x(14)**2)/(2.*L(1))) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - (((k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2) - (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(0) + &
        &  (((k(3)*L(3)*(L(3)**2 - 2*L(4)**2))/(L(3)**2 + L(4)**2)**2 - &
        &       (k(2)*(L(2)**3 - 2*L(2)*L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(0)**2)/2. + &
        &  ((k(2)*L(2)**2)/(L(2)**2 + L(4)**2) + (k(3)*L(3)**2)/(L(3)**2 + L(4)**2))*x(2) + &
        &  (-(k(1)/L(1)) - (k(3)*L(4)*(-2*L(3)**2 + L(4)**2))/(L(3)**2 + L(4)**2)**2 + &
        &     (k(2)*(2*L(2)**2*L(4) - L(4)**3))/(L(2)**2 + L(4)**2)**2)*x(0)*x(2) + &
        &  (3*L(4)**2*(k(3)*L(3)*(L(2)**2 + L(4)**2)**2 - k(2)*L(2)*(L(3)**2 + L(4)**2)**2)*&
        &     x(2)**2)/(2.*(L(2)**2 + L(4)**2)**2*(L(3)**2 + L(4)**2)**2) + &
        &  (k(1)*x(2)*x(12))/L(1) + (k(1)*x(0)*x(14))/L(1) - (k(1)*x(12)*x(14))/L(1)) )/m(2)

    else if (BC_flag == 120) then
        f(1) = x(1)

        f(2) = ( p(1) - b(1)*x(1) - (-(k(1)*x(-12)) + (k(1)*x(-10)**2)/(2.*L(1)) + &
        &  (k(1) + L(4)**2*(k(2)/(L(2)**2 + L(4)**2) + k(3)/(L(3)**2 + L(4)**2)))*x(0) - &
        &  (3*L(4)*(k(3)*L(3)**2*(L(2)**2 + L(4)**2)**2 + k(2)*L(2)**2*(L(3)**2 + L(4)**2)**2)*&
        &     x(0)**2)/(2.*(L(2)**2 + L(4)**2)**2*(L(3)**2 + L(4)**2)**2) - &
        &  (k(1)*x(-10)*x(2))/L(1) + ((k(3)*L(3)*(L(3)**2 - 2*L(4)**2))/(L(3)**2 + L(4)**2)**2 - &
        &     (k(2)*(L(2)**3 - 2*L(2)*L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(0)*x(2) + &
        &  ((k(1)/L(1) - (k(3)*L(4)*(-2*L(3)**2 + L(4)**2))/(L(3)**2 + L(4)**2)**2 + &
        &       (k(2)*(2*L(2)**2*L(4) - L(4)**3))/(L(2)**2 + L(4)**2)**2)*x(2)**2)/2. + &
        &  (3*k(2)*L(2)**2*L(4)*x(0)*x(4))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(2)*x(4))/(L(2)**2 + L(4)**2)**2 - &
        &  (3*k(2)*L(2)**2*L(4)*x(4)**2)/(2.*(L(2)**2 + L(4)**2)**2) + &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)*x(6))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(2)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(4)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(6)**2)/(2.*(L(2)**2 + L(4)**2)**2) + &
        &  (3*k(3)*L(3)**2*L(4)*x(0)*x(8))/(L(3)**2 + L(4)**2)**2 - &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(2)*x(8))/(L(3)**2 + L(4)**2)**2 - &
        &  (3*k(3)*L(3)**2*L(4)*x(8)**2)/(2.*(L(3)**2 + L(4)**2)**2) - &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)*x(10))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(2)*x(10))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(8)*x(10))/(L(3)**2 + L(4)**2)**2 - &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(10)**2)/(2.*(L(3)**2 + L(4)**2)**2) + &
        &  L(4)*((k(2)*L(2)*x(2))/(L(2)**2 + L(4)**2) - (k(3)*L(3)*x(2))/(L(3)**2 + L(4)**2) - &
        &     (k(2)*L(4)*x(4))/(L(2)**2 + L(4)**2) - (k(2)*L(2)*x(6))/(L(2)**2 + L(4)**2) - &
        &     (k(3)*L(4)*x(8))/(L(3)**2 + L(4)**2) + (k(3)*L(3)*x(10))/(L(3)**2 + L(4)**2))) )/m(1)

        f(3) = x(3)

        f(4) = ( p(2) - b(2)*x(3) - ((k(1)*x(-12)*x(-10))/L(1) + ((k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2) - &
        &     (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(0) - (k(1)*x(-10)*x(0))/L(1) + &
        &  (((k(3)*L(3)*(L(3)**2 - 2*L(4)**2))/(L(3)**2 + L(4)**2)**2 - &
        &       (k(2)*(L(2)**3 - 2*L(2)*L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(0)**2)/2. + &
        &  (k(2)*L(2)**2*x(2))/(L(2)**2 + L(4)**2) + (k(3)*L(3)**2*x(2))/(L(3)**2 + L(4)**2) - &
        &  (k(1)*x(-12)*x(2))/L(1) + (k(1)/L(1) - &
        &     (k(3)*L(4)*(-2*L(3)**2 + L(4)**2))/(L(3)**2 + L(4)**2)**2 + &
        &     (k(2)*(2*L(2)**2*L(4) - L(4)**3))/(L(2)**2 + L(4)**2)**2)*x(0)*x(2) + &
        &  (3*L(4)**2*(k(3)*L(3)*(L(2)**2 + L(4)**2)**2 - k(2)*L(2)*(L(3)**2 + L(4)**2)**2)*&
        &     x(2)**2)/(2.*(L(2)**2 + L(4)**2)**2*(L(3)**2 + L(4)**2)**2) - &
        &  (k(2)*L(2)*L(4)*x(4))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)*x(4))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(2)*x(4))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(4)**2)/(2.*(L(2)**2 + L(4)**2)**2) - &
        &  (k(2)*L(2)**2*x(6))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(0)*x(6))/(L(2)**2 + L(4)**2)**2 + &
        &  (3*k(2)*L(2)*L(4)**2*x(2)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(4)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (3*k(2)*L(2)*L(4)**2*x(6)**2)/(2.*(L(2)**2 + L(4)**2)**2) + &
        &  (k(3)*L(3)*L(4)*x(8))/(L(3)**2 + L(4)**2) - &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)*x(8))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(2)*x(8))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(8)**2)/(2.*(L(3)**2 + L(4)**2)**2) - &
        &  (k(3)*L(3)**2*x(10))/(L(3)**2 + L(4)**2) + &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(0)*x(10))/(L(3)**2 + L(4)**2)**2 - &
        &  (3*k(3)*L(3)*L(4)**2*x(2)*x(10))/(L(3)**2 + L(4)**2)**2 - &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(8)*x(10))/(L(3)**2 + L(4)**2)**2 + &
        &  (3*k(3)*L(3)*L(4)**2*x(10)**2)/(2.*(L(3)**2 + L(4)**2)**2)) )/m(2)

        f(5) = x(5)

        f(6) = ( p(3) - b(3)*x(5) - (-(k(4)*x(-8)) + (k(4)*x(-6)**2)/(2.*L(1)) - &
        &  (k(7)*L(1)**2*x(-4))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (3*k(7)*L(1)*(L(2) + L(3))**2*x(-4)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(7)*L(1)*(L(2) + L(3))*x(-2))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-4)*x(-2))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-2)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - (k(2)*L(4)**2*x(0))/(L(2)**2 + L(4)**2) + &
        &  (3*k(2)*L(2)**2*L(4)*x(0)**2)/(2.*(L(2)**2 + L(4)**2)**2) - &
        &  (k(2)*L(2)*L(4)*x(2))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)*x(2))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(2)**2)/(2.*(L(2)**2 + L(4)**2)**2) + &
        &  (k(4) + (k(7)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(4)**2)/(L(2)**2 + L(4)**2))*x(4) - &
        &  (3*k(7)*L(1)*(L(2) + L(3))**2*x(-4)*x(4))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-2)*x(4))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(2)*L(2)**2*L(4)*x(0)*x(4))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(2)*x(4))/(L(2)**2 + L(4)**2)**2 + &
        &  (3*(k(2)*L(2)**2*(L(1)**2 + (L(2) + L(3))**2)**2*L(4) + &
        &       k(7)*L(1)*(L(2) + L(3))**2*(L(2)**2 + L(4)**2)**2)*x(4)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2*(L(2)**2 + L(4)**2)**2) + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2))*x(6) - (k(4)*x(-6)*x(6))/L(1) - &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-4)*x(6))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-2)*x(6))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(2)*x(6))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(6)/(L(2) + L(3)) + (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2))/&
        &      (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &     (k(2)*L(2)*(L(2)**2 - 2*L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(4)*x(6) + &
        &  ((k(4)/L(1) + (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/&
        &        (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &       (k(2)*L(4)*(-2*L(2)**2 + L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(6)**2)/2. - &
        &  (k(6)*x(6)*x(8))/(L(2) + L(3)) - (k(6)*x(4)*x(10))/(L(2) + L(3)) + &
        &  (k(6)*x(8)*x(10))/(L(2) + L(3))) )/m(3)

        f(7) = x(7)

        f(8) = ( p(4) - b(4)*x(7) - ((k(4)*x(-8)*x(-6))/L(1) - (k(7)*L(1)*(L(2) + L(3))*x(-4))/&
        &   (L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-4)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(7)*(L(2) + L(3))**2*x(-2))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-4)*x(-2))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (3*k(7)*L(1)**2*(L(2) + L(3))*x(-2)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(2)*L(2)*L(4)*x(0))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)**2)/(2.*(L(2)**2 + L(4)**2)**2) - &
        &  (k(2)*L(2)**2*x(2))/(L(2)**2 + L(4)**2) + &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(0)*x(2))/(L(2)**2 + L(4)**2)**2 + &
        &  (3*k(2)*L(2)*L(4)**2*x(2)**2)/(2.*(L(2)**2 + L(4)**2)**2) + &
        &  ((k(7)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)*L(4))/(L(2)**2 + L(4)**2))*x(4) - (k(4)*x(-6)*x(4))/L(1) - &
        &  (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-4)*x(4))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-2)*x(4))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(2)*L(2)*(L(2)**2 - 2*L(4)**2)*x(0)*x(4))/(L(2)**2 + L(4)**2)**2 - &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(2)*x(4))/(L(2)**2 + L(4)**2)**2 + &
        &  ((k(6)/(L(2) + L(3)) + (k(7)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2))/&
        &        (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &       (k(2)*L(2)*(L(2)**2 - 2*L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(4)**2)/2. + &
        &  (k(6) + (k(7)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(2)*L(2)**2)/(L(2)**2 + L(4)**2))*x(6) - (k(4)*x(-8)*x(6))/L(1) - &
        &  (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-4)*x(6))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(7)*L(1)**2*(L(2) + L(3))*x(-2)*x(6))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(2)*L(4)*(-2*L(2)**2 + L(4)**2)*x(0)*x(6))/(L(2)**2 + L(4)**2)**2 - &
        &  (3*k(2)*L(2)*L(4)**2*x(2)*x(6))/(L(2)**2 + L(4)**2)**2 + &
        &  (k(4)/L(1) + (k(7)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/&
        &      (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &     (k(2)*L(4)*(-2*L(2)**2 + L(4)**2))/(L(2)**2 + L(4)**2)**2)*x(4)*x(6) + &
        &  (3*(k(2)*L(2)*(L(1)**2 + (L(2) + L(3))**2)**2*L(4)**2 + &
        &       k(7)*L(1)**2*(L(2) + L(3))*(L(2)**2 + L(4)**2)**2)*x(6)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2*(L(2)**2 + L(4)**2)**2) - &
        &  (k(6)*x(4)*x(8))/(L(2) + L(3)) + (k(6)*x(8)**2)/(2.*(L(2) + L(3))) - k(6)*x(10)) )/m(4)

        f(9) = x(9)

        f(10) = ( p(5) - b(5)*x(9) - (-((k(8)*L(1)**2*x(-8))/(L(1)**2 + (L(2) + L(3))**2)) + &
        &  (3*k(8)*L(1)*(L(2) + L(3))**2*x(-8)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) + &
        &  (k(8)*L(1)*(L(2) + L(3))*x(-6))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-8)*x(-6))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-6)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - k(5)*x(-4) + (k(5)*x(-2)**2)/(2.*L(1)) - &
        &  (k(3)*L(4)**2*x(0))/(L(3)**2 + L(4)**2) + &
        &  (3*k(3)*L(3)**2*L(4)*x(0)**2)/(2.*(L(3)**2 + L(4)**2)**2) + &
        &  (k(3)*L(3)*L(4)*x(2))/(L(3)**2 + L(4)**2) - &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)*x(2))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(2)**2)/(2.*(L(3)**2 + L(4)**2)**2) - &
        &  (k(6)*x(4)*x(6))/(L(2) + L(3)) + &
        &  (k(5) + (k(8)*L(1)**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(3)*L(4)**2)/(L(3)**2 + L(4)**2))*x(8) - &
        &  (3*k(8)*L(1)*(L(2) + L(3))**2*x(-8)*x(8))/(L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-6)*x(8))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(3)*L(3)**2*L(4)*x(0)*x(8))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(2)*x(8))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(6)*x(6)*x(8))/(L(2) + L(3)) + &
        &  (3*(k(3)*L(3)**2*(L(1)**2 + (L(2) + L(3))**2)**2*L(4) + &
        &       k(8)*L(1)*(L(2) + L(3))**2*(L(3)**2 + L(4)**2)**2)*x(8)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2*(L(3)**2 + L(4)**2)**2) + &
        &  (-((k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2)) - &
        &     (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(10) + &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-8)*x(10))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-6)*x(10))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - (k(5)*x(-2)*x(10))/L(1) + &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)*x(10))/(L(3)**2 + L(4)**2)**2 - &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(2)*x(10))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(6)*x(4)*x(10))/(L(2) + L(3)) + &
        &  (-(k(6)/(L(2) + L(3))) - (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2))/&
        &      (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &     (k(3)*L(3)*(L(3)**2 - 2*L(4)**2))/(L(3)**2 + L(4)**2)**2)*x(8)*x(10) + &
        &  ((k(5)/L(1) + (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/&
        &        (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &       (k(3)*L(4)*(-2*L(3)**2 + L(4)**2))/(L(3)**2 + L(4)**2)**2)*x(10)**2)/2.) )/m(5)

        f(11) = x(11)

        f(12) = ( p(6) - b(6)*x(11) - ((k(8)*L(1)*(L(2) + L(3))*x(-8))/(L(1)**2 + (L(2) + L(3))**2) - &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-8)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2) - &
        &  (k(8)*(L(2) + L(3))**2*x(-6))/(L(1)**2 + (L(2) + L(3))**2) + &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-8)*x(-6))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (3*k(8)*L(1)**2*(L(2) + L(3))*x(-6)**2)/(2.*(L(1)**2 + (L(2) + L(3))**2)**2) + &
        &  (k(5)*x(-4)*x(-2))/L(1) + (k(3)*L(3)*L(4)*x(0))/(L(3)**2 + L(4)**2) - &
        &  (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)**2)/(2.*(L(3)**2 + L(4)**2)**2) - &
        &  (k(3)*L(3)**2*x(2))/(L(3)**2 + L(4)**2) + &
        &  (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(0)*x(2))/(L(3)**2 + L(4)**2)**2 - &
        &  (3*k(3)*L(3)*L(4)**2*x(2)**2)/(2.*(L(3)**2 + L(4)**2)**2) - &
        &  (k(6)*x(4)**2)/(2.*(L(2) + L(3))) - k(6)*x(6) + &
        &  (-((k(8)*L(1)*(L(2) + L(3)))/(L(1)**2 + (L(2) + L(3))**2)) - &
        &     (k(3)*L(3)*L(4))/(L(3)**2 + L(4)**2))*x(8) + &
        &  (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2)*x(-8)*x(8))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-6)*x(8))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(5)*x(-2)*x(8))/L(1) + (k(3)*L(3)*(L(3)**2 - 2*L(4)**2)*x(0)*x(8))/&
        &   (L(3)**2 + L(4)**2)**2 - (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(2)*x(8))/&
        &   (L(3)**2 + L(4)**2)**2 + (k(6)*x(4)*x(8))/(L(2) + L(3)) + &
        &  ((-(k(6)/(L(2) + L(3))) - (k(8)*(L(2) + L(3))*(-2*L(1)**2 + (L(2) + L(3))**2))/&
        &        (L(1)**2 + (L(2) + L(3))**2)**2 - &
        &       (k(3)*L(3)*(L(3)**2 - 2*L(4)**2))/(L(3)**2 + L(4)**2)**2)*x(8)**2)/2. + &
        &  (k(6) + (k(8)*(L(2) + L(3))**2)/(L(1)**2 + (L(2) + L(3))**2) + &
        &     (k(3)*L(3)**2)/(L(3)**2 + L(4)**2))*x(10) - &
        &  (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2)*x(-8)*x(10))/&
        &   (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &  (3*k(8)*L(1)**2*(L(2) + L(3))*x(-6)*x(10))/(L(1)**2 + (L(2) + L(3))**2)**2 - &
        &  (k(5)*x(-4)*x(10))/L(1) - (k(3)*L(4)*(-2*L(3)**2 + L(4)**2)*x(0)*x(10))/&
        &   (L(3)**2 + L(4)**2)**2 + (3*k(3)*L(3)*L(4)**2*x(2)*x(10))/(L(3)**2 + L(4)**2)**2 + &
        &  (k(5)/L(1) + (k(8)*L(1)*(L(1)**2 - 2*(L(2) + L(3))**2))/&
        &      (L(1)**2 + (L(2) + L(3))**2)**2 + &
        &     (k(3)*L(4)*(-2*L(3)**2 + L(4)**2))/(L(3)**2 + L(4)**2)**2)*x(8)*x(10) - &
        &  (3*(k(3)*L(3)*(L(1)**2 + (L(2) + L(3))**2)**2*L(4)**2 + &
        &       k(8)*L(1)**2*(L(2) + L(3))*(L(3)**2 + L(4)**2)**2)*x(10)**2)/&
        &   (2.*(L(1)**2 + (L(2) + L(3))**2)**2*(L(3)**2 + L(4)**2)**2)) )/m(6)

    end if

    end subroutine calc_fQuad


    subroutine calc_f_pendula(BC_flag, lowerBound, upperBound, m, b, p, G, k, L, x, f)

    implicit none

    !! Data dictionary
    integer, intent(in) :: BC_flag
    integer, intent(in) :: lowerBound
    integer, intent(in) :: upperBound
    real, intent(in), dimension(2) :: m
    real, intent(in), dimension(1) :: b
    real, intent(in), dimension(1) :: p
    real, intent(in) :: G
    real, intent(in), dimension(1) :: k
    real, intent(in), dimension(1) :: L
    real, intent(in), dimension(lowerBound:upperBound) :: x
    real, intent(out), dimension(2) :: f

    if (BC_flag == 100) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (G*L(1)*m(2)*Sin(x(0)) - k(1)*x(-2) + 2*k(1)*x(0) - k(1)*x(2)) )/m(1)
    else if (BC_flag == 110) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (G*L(1)*m(2)*Sin(x(0)) + k(1)*(x(0) - x(2))) )/m(1)
    else if (BC_flag == 120) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (G*L(1)*m(2)*Sin(x(0)) - k(1)*x(-2) + k(1)*x(0)) )/m(1)
    else if (BC_flag == 121) then
        f(1) = 0.
        f(2) = 0.
    end if

    end subroutine calc_f_pendula


    subroutine calc_f_phi4(BC_flag, lowerBound, upperBound, m, b, p, k, x, f)

    implicit none

    !! Data dictionary
    integer, intent(in) :: BC_flag
    integer, intent(in) :: lowerBound
    integer, intent(in) :: upperBound
    real, intent(in), dimension(1) :: m
    real, intent(in), dimension(1) :: b
    real, intent(in), dimension(1) :: p
    real, intent(in), dimension(5) :: k
    real, intent(in), dimension(lowerBound:upperBound) :: x
    real, intent(out), dimension(2) :: f

    if (BC_flag == 100) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (k(2) - k(1)*x(-2) + 2*(k(1) + k(3))*x(0) + 3*k(4)*x(0)**2 + 4*k(5)*x(0)**3 - k(1)*x(2)) )/m(1)
    else if (BC_flag == 110) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (k(2) + k(1)*x(0) + 2*k(3)*x(0) + 3*k(4)*x(0)**2 + 4*k(5)*x(0)**3 - k(1)*x(2)) )/m(1)
    else if (BC_flag == 120) then
        f(1) = x(1)
        f(2) = ( p(1) - b(1)*x(1) - (k(2) - k(1)*x(-2) + (k(1) + 2*k(3))*x(0) + 3*k(4)*x(0)**2 + 4*k(5)*x(0)**3) )/m(1)
    else if (BC_flag == 121) then
        f(1) = 0.
        f(2) = 0.
    end if

    end subroutine calc_f_phi4


end module sub_RK
